<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN - THE HOON STUDIO</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- Firebase SDK Ï∂îÍ∞Ä -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, orderBy, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';
        
                // Firebase ÏÑ§Ï†ï - Ïó¨Í∏∞Ïóê Î≥∏Ïù∏Ïùò Firebase ÏÑ§Ï†ïÍ∞íÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî
        const firebaseConfig = {
            apiKey: "AIzaSyDUJrHXzQfZ2-FwaZcuMcLu-71gRTVO2b4",
            authDomain: "the-hoon-studio.firebaseapp.com",
            projectId: "the-hoon-studio",
            storageBucket: "the-hoon-studio.firebasestorage.app",
            messagingSenderId: "857575526697",
            appId: "1:857575526697:web:43d66881a72f96e5a6e738"
        };

        
        // Firebase Ï¥àÍ∏∞Ìôî
        console.log('Firebase Ï¥àÍ∏∞Ìôî ÏãúÏûë...');
        const app = initializeApp(firebaseConfig);
        console.log('Firebase Ïï± Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
        
        const db = getFirestore(app);
        console.log('Firestore Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
        
        // Ïò§ÌîÑÎùºÏù∏ ÏßÄÏÜçÏÑ± ÎπÑÌôúÏÑ±Ìôî (Î¨∏Ï†ú Ìï¥Í≤∞Ïö©)
        try {
            db._delegate._databaseId.projectId = firebaseConfig.projectId;
            console.log('Ïò§ÌîÑÎùºÏù∏ ÏÑ§Ï†ï Ï†ÅÏö© ÏôÑÎ£å');
        } catch (error) {
            console.log('Ïò§ÌîÑÎùºÏù∏ ÏÑ§Ï†ï Ïä§ÌÇµ:', error);
        }
        
        // Firebase Storage Ï¥àÍ∏∞Ìôî
        const storage = getStorage(app);
        console.log('Firebase Storage Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
        
        // Ï†ÑÏó≠ÏóêÏÑú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎèÑÎ°ù ÏÑ§Ï†ï
        window.db = db;
        window.storage = storage;
        window.firestoreFunctions = {
            collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, orderBy, getDoc
        };
        window.storageFunctions = {
            ref, uploadBytes, getDownloadURL
        };
        
        console.log('Firebase Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
        console.log('window.db ÏÑ§Ï†ïÎê®:', !!window.db);
        console.log('window.firestoreFunctions ÏÑ§Ï†ïÎê®:', !!window.firestoreFunctions);
    </script>
    
    <style>
        /* ÌÜ†Ïä§ Ïä§ÌÉÄÏùº Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ Ï†ÑÏö© Ïä§ÌÉÄÏùº */
        body.admin-page {
            background-color: #000000;
            background-image: none;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #ffffff;
            margin: 0;
            padding: 0;
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .admin-header {
            background: #111111;
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 40px;
            border: 1px solid #333333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(20px);
        }

        .admin-title {
            font-family: 'Syncopate-Bold', sans-serif;
            font-size: 28px;
            color: #ffffff;
            margin: 0;
            font-weight: 700;
        }

        .logout-btn {
            background: #ffffff;
            color: #000000;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .logout-btn:hover {
            background: #f0f0f0;
            transform: translateY(-1px);
        }

        /* Firebase Ïó∞Í≤∞ ÏÉÅÌÉú ÌëúÏãú */
        .firebase-status {
            padding: 16px;
            margin-bottom: 30px;
            border-radius: 12px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
            border: 1px solid;
        }

        .firebase-connected {
            background: #0a0a0a;
            color: #00ff88;
            border-color: #00ff88;
        }

        .firebase-error {
            background: #0a0a0a;
            color: #ff4444;
            border-color: #ff4444;
        }

        /* Î°úÍ∑∏Ïù∏ Ìèº - ÌÜ†Ïä§ Ïä§ÌÉÄÏùº */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #000000;
        }

        .login-form {
            background: #111111;
            padding: 50px;
            border-radius: 20px;
            border: 1px solid #333333;
            width: 100%;
            max-width: 450px;
            backdrop-filter: blur(20px);
        }

        .login-form h2 {
            font-family: 'Syncopate-Bold', sans-serif;
            text-align: center;
            margin-bottom: 40px;
            color: #ffffff;
            font-size: 28px;
            font-weight: 700;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #ffffff;
            font-size: 14px;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 16px;
            border: 1px solid #333333;
            border-radius: 12px;
            font-size: 16px;
            box-sizing: border-box;
            background: #0a0a0a;
            color: #ffffff;
            transition: all 0.2s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #ffffff;
            background: #111111;
        }

        .form-group textarea {
            height: 120px;
            resize: vertical;
        }

        .btn {
            background: #ffffff;
            color: #000000;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 600;
            width: auto;
            min-width: 150px;
            text-align: center;
            transition: all 0.2s ease;
        }

        .btn:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255,255,255,0.2);
        }

        .btn:disabled {
            background: #333333;
            color: #666666;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: #00ff88;
            color: #000000;
        }

        .btn-success:hover {
            background: #00cc6a;
        }

        .btn-danger {
            background: #ff4444;
            color: #ffffff;
            padding: 10px 20px;
            font-size: 14px;
            width: auto;
        }

        .btn-danger:hover {
            background: #ff2222;
        }

        .btn-edit {
            background: #ffffff;
            color: #000000;
            padding: 10px 20px;
            font-size: 14px;
            width: auto;
            margin-right: 10px;
        }

        .btn-edit:hover {
            background: #f0f0f0;
        }

        /* ÌîÑÎ°úÏ†ùÌä∏ Í¥ÄÎ¶¨ ÏòÅÏó≠ */
        .admin-section {
            background: #111111;
            padding: 40px;
            border-radius: 16px;
            margin-bottom: 40px;
            border: 1px solid #333333;
            backdrop-filter: blur(20px);
        }

        .section-title {
            font-family: 'Syncopate-Regular', sans-serif;
            font-size: 20px;
            margin-bottom: 30px;
            color: #ffffff;
            border-bottom: 2px solid #ffffff;
            padding-bottom: 15px;
            font-weight: 600;
        }

        .project-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
            border-radius: 12px;
            overflow: hidden;
        }

        .project-table th,
        .project-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid #333333;
        }

        .project-table th {
            background: #0a0a0a;
            font-weight: 600;
            color: #ffffff;
            font-size: 14px;
        }

        .project-table td {
            color: #ffffff;
            font-size: 14px;
        }

        .project-table tr:hover {
            background: #1a1a1a;
        }

        .alert {
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 12px;
            font-weight: 500;
        }

        .alert-success {
            background: #0a0a0a;
            color: #00ff88;
            border: 1px solid #00ff88;
        }

        .alert-error {
            background: #0a0a0a;
            color: #ff4444;
            border: 1px solid #ff4444;
        }

        .hidden {
            display: none;
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* Ïä¨ÎùºÏù¥Îìú Ïù¥ÎØ∏ÏßÄ Í¥ÄÎ¶¨ Ïä§ÌÉÄÏùº Ï∂îÍ∞Ä */
        .slide-images-container,
        .additional-images-container {
            margin-bottom: 20px;
        }

        .slide-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
            min-height: 60px;
            border: 2px dashed #333333;
            padding: 20px;
            border-radius: 12px;
            background: #0a0a0a;
        }

        .slide-preview-item {
            position: relative;
            background: #111111;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #333333;
            cursor: move;
            transition: all 0.2s ease;
        }

        .slide-preview-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255,255,255,0.1);
        }

        .slide-preview-img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            display: block;
        }

        .slide-preview-controls {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            gap: 8px;
        }

        .slide-control-btn {
            width: 30px;
            height: 30px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            background: rgba(0,0,0,0.8);
            color: #ffffff;
            transition: all 0.2s ease;
        }

        .delete-slide-btn {
            color: #ff4444;
        }

        .delete-slide-btn:hover {
            background: #ff4444;
            color: white;
            transform: scale(1.1);
        }

        .slide-preview-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .form-help {
            color: #999999;
            font-size: 12px;
            margin-top: 8px;
        }

        /* Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞ Ïä§ÌÉÄÏùº Ï∂îÍ∞Ä */
        .image-preview-single {
            margin-top: 15px;
            max-width: 200px;
        }

        .image-preview-single img {
            width: 100%;
            height: auto;
            border-radius: 12px;
            border: 1px solid #333333;
        }

        .additional-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
            min-height: 50px;
            border: 2px dashed #333333;
            padding: 15px;
            border-radius: 12px;
            background: #0a0a0a;
        }

        .additional-preview-item {
            position: relative;
            background: #111111;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #333333;
            transition: all 0.2s ease;
        }

        .additional-preview-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255,255,255,0.1);
        }

        .additional-preview-img {
            width: 100%;
            height: 80px;
            object-fit: cover;
            display: block;
        }

        /* Î≤ÑÌäº Ïª®ÌÖåÏù¥ÎÑà Ïä§ÌÉÄÏùº */
        .button-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 25px; /* Î≤ÑÌäº ÏÇ¨Ïù¥ Í∞ÑÍ≤© */
            margin-top: 30px;
            flex-wrap: wrap; /* ÌôîÎ©¥Ïù¥ ÏûëÏùÑ Îïå Ï§ÑÎ∞îÍøà */
        }
        
        /* Ï∑®ÏÜå Î≤ÑÌäº Ïä§ÌÉÄÏùº */
        .btn-secondary {
            background: #333333;
            color: #ffffff;
        }
        
        .btn-secondary:hover {
            background: #444444;
        }

        /* Î°úÍ∑∏Ïù∏ ÌèºÏùò Î≤ÑÌäºÏùÄ ÏòàÏô∏Ï†ÅÏúºÎ°ú Ï†ÑÏ≤¥ ÎÑàÎπÑ Ïú†ÏßÄ */
        .login-form .btn {
            width: 100%;
        }
        
        /* ÌÖåÏù¥Î∏î ÎÇ¥ Î≤ÑÌäºÎì§ÏùÄ Í∏∞Ï°¥ Ïä§ÌÉÄÏùº Ïú†ÏßÄ */
        .btn-edit,
        .btn-danger {
            width: auto;
            min-width: auto;
            padding: 10px 20px;
            font-size: 14px;
        }

        .file-input-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }

        .custom-file-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .custom-file-btn:hover {
            background-color: #0056b3;
        }

        .file-name {
            color: #666;
            font-size: 14px;
        }
        
        /* Î∞òÏùëÌòï ÎîîÏûêÏù∏ */
        @media (max-width: 768px) {
            .button-container {
                flex-direction: column;
                gap: 20px;
            }
            
            .btn {
                width: 100%;
                min-width: auto;
            }
        }

        /* Î°úÎî© Ïä§ÌîºÎÑà */
        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid #333333;
            border-top: 3px solid #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 12px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Ï∂îÍ∞Ä ÌÜ†Ïä§ Ïä§ÌÉÄÏùº ÏöîÏÜåÎì§ */
        .hidden {
            display: none !important;
        }

        .form-row {
            display: flex;
            gap: 25px;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* Ïä§ÌÅ¨Î°§Î∞î Ïä§ÌÉÄÏùºÎßÅ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0a0a0a;
        }

        ::-webkit-scrollbar-thumb {
            background: #333333;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #444444;
        }
    </style>
</head>
<body class="admin-page">
    <!-- Î°úÍ∑∏Ïù∏ ÌôîÎ©¥ - placeholder Ï†úÍ±∞ -->
    <div id="loginScreen" class="login-container">
        <div class="login-form">
            <h2>ADMIN LOGIN</h2>
            <div id="loginAlert" class="alert alert-error hidden"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">ÏÇ¨Ïö©ÏûêÎ™Ö</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label for="password">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn">Î°úÍ∑∏Ïù∏</button>
            </form>
        </div>
    </div>

    <!-- Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú -->
    <div id="adminDashboard" class="hidden">
        <div class="admin-container">
            <!-- Firebase Ïó∞Í≤∞ ÏÉÅÌÉú -->
            <div id="firebaseStatus" class="firebase-status firebase-error">
                üî• Firebase Ïó∞Í≤∞ÏùÑ ÌôïÏù∏ÌïòÎäî Ï§ë...
            </div>

            <!-- Ìó§Îçî -->
                    <div class="admin-header">
            <h1 class="admin-title">THE HOON STUDIO - Admin Panel</h1>
            <div style="display: flex; gap: 10px;">
                <button onclick="migrateMemberImagesToStorage()" class="btn-success" style="font-size: 12px; padding: 8px 16px;">Member Migration</button>
                <button onclick="migrateProjectImagesToStorage()" class="btn-success" style="font-size: 12px; padding: 8px 16px;">Project Image Migration</button>
                <button id="logoutBtn" class="logout-btn">Logout</button>
            </div>
        </div>

            <!-- ÏïåÎ¶º Î©îÏãúÏßÄ -->
            <div id="alertMessage" class="alert hidden"></div>

            <!-- ÌîÑÎ°úÏ†ùÌä∏ Ï∂îÍ∞Ä Ìèº -->
            <div class="admin-section">
                <h2 class="section-title">Add New Project</h2>
                <form id="projectForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectName">PROJECT NAME (e.g. abc.def)</label>
                            <input type="text" id="projectName" required placeholder="abc.def">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectCategory">Category</label>
                            <select id="projectCategory" required>
                                <option value="architecture">ARCHITECTURE</option>
                                <option value="interior">INTERIOR</option>
                                <option value="visualization">VISUALIZATION</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Subcategory (Multiple selection available)</label>
                            <div id="projectCategories" style="display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 6px 18px; justify-items: start; max-width: 600px; margin: 0 auto 8px auto;">
                                <label style="display: flex; align-items: center; gap: 4px; white-space: nowrap; font-size: 0.675em;"><input type="checkbox" name="projectCategories" value="D"> Design Development (D)</label>
                                <label style="display: flex; align-items: center; gap: 4px; white-space: nowrap; font-size: 0.675em;"><input type="checkbox" name="projectCategories" value="P"> Building Permit (P)</label>
                                <label style="display: flex; align-items: center; gap: 4px; white-space: nowrap; font-size: 0.675em;"><input type="checkbox" name="projectCategories" value="E"> Execution Planning (E)</label>
                                <label style="display: flex; align-items: center; gap: 4px; white-space: nowrap; font-size: 0.675em;"><input type="checkbox" name="projectCategories" value="H"> Heritage Preservation (H)</label>
                                <label style="display: flex; align-items: center; gap: 4px; white-space: nowrap; font-size: 0.675em;"><input type="checkbox" name="projectCategories" value="N"> New Construction (N)</label>
                                <label style="display: flex; align-items: center; gap: 4px; white-space: nowrap; font-size: 0.675em;"><input type="checkbox" name="projectCategories" value="R"> Renovation (R)</label>
                                <label style="display: flex; align-items: center; gap: 4px; white-space: nowrap; font-size: 0.675em;"><input type="checkbox" name="projectCategories" value="M/G"> Marketing/Graphic Design (M/G)</label>
                                <label style="display: flex; align-items: center; gap: 4px; white-space: nowrap; font-size: 0.675em;"><input type="checkbox" name="projectCategories" value="I/R"> Interior Design/Rendering (I/R)</label>
                                <label style="display: flex; align-items: center; gap: 4px; white-space: nowrap; font-size: 0.675em;"><input type="checkbox" name="projectCategories" value="C"> Competition (C)</label>
                        </div>
                        </div>
                        <!--
                        <div class="form-group">
                            <label for="projectCategory">KATEGORIE</label>
                            <select id="projectCategory" required>
                                <option value="">KATEGORIE AUSWAHL</option>
                                <option value="architecture">ARCHITECTURE</option>
                                <option value="interior-rendering">INTERIOR DESIGN/RENDERING</option>
                            </select>
                        </div>
                        -->
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectYear">YEAR</label>
                            <input type="number" id="projectYear" placeholder="2024 (optional)">
                        </div>
                        <div class="form-group">
                            <label for="projectStatus">STATUS</label>
                            <select id="projectStatus">
                                <option value="In Planning">In Planning</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Completed">Completed</option>
                                <option value="On Hold">On Hold</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectName">PROJECT</label>
                            <input type="text" id="projectName" placeholder="Project Name">
                        </div>
                        <div class="form-group">
                            <label for="projectClient">CLIENT</label>
                            <input type="text" id="projectClient" placeholder="Client Name">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectLocation">LOCATION</label>
                            <input type="text" id="projectLocation" placeholder="Location">
                        </div>
                        <div class="form-group">
                            <label for="projectService">PROVIDED SERVICE</label>
                            <input type="text" id="projectService" placeholder="Service Type">
                        </div>
                    </div>

                    <!-- Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ ÏÑπÏÖò -->
                    <div class="form-group">
                            <label for="projectImage">MAIN IMAGE (PROJECT REPRESENTATIVE IMAGE):</label>
                            <div class="file-input-wrapper">
                                <input type="file" id="projectImage" name="projectImage" accept="image/*" required style="display: none;">
                                <button type="button" class="custom-file-btn" onclick="document.getElementById('projectImage').click()">Choose File</button>
                                <span id="projectImageName" class="file-name">No file selected</span>
                            </div>
                        <div id="mainImagePreview" class="image-preview-single"></div>
                            <small class="form-help">This image will be displayed on the project list and at the top of the detail page. (Saved in original quality)<br>
                            <strong>High quality recommended:</strong> Minimum 1920x1080px, JPG/PNG format, file size 1-10MB</small>
                    </div>



                    <!-- Ï∂îÍ∞Ä Ïù¥ÎØ∏ÏßÄ ÏÑπÏÖò -->
                    <div class="form-group">
                            <label for="additionalImages">ADDITIONAL GALLERY IMAGES (FOR SUBSECTION):</label>
                            <div class="file-input-wrapper">
                                <input type="file" id="additionalImages" name="additionalImages" accept="image/*" multiple style="display: none;">
                                <button type="button" class="custom-file-btn" onclick="document.getElementById('additionalImages').click()">Choose Files</button>
                                <span id="additionalImagesName" class="file-name">No files selected</span>
                        </div>
                        <div class="additional-preview-container" id="additionalPreviewContainer">
                                <!-- Additional image preview -->
                        </div>
                            <small class="form-help">Images that will be displayed in the other section of the page. (Saved in original quality)</small>
                    </div>

                    <div class="form-group">
                        <div class="button-container">
                            <button type="submit" class="btn btn-success" id="submitBtn">ADD PROJECT</button>
                            <button type="button" id="cancelEdit" class="btn btn-secondary hidden">CANCEL</button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ù -->
            <div class="admin-section">
                <h2 class="section-title">REGISTERED PROJECTS</h2>
                

                
                <div id="projectsLoader" class="hidden" style="text-align: center; padding: 20px;">
                    <div class="loading"></div> LOADING PROJECTS...
                </div>
                <table class="project-table">
                    <thead>
                        <tr>
                            <th>PROJECT NAME</th>
                            <th>CATEGORY</th>
                            <th>LOCATION</th>
                            <th>YEAR</th>
                            <th>STATUS</th>
                            <th>MANAGE</th>
                        </tr>
                    </thead>
                    <tbody id="projectList">
                        <!-- ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                    </tbody>
                </table>
            </div>

            <!-- Î©§Î≤Ñ Ï∂îÍ∞Ä ÏÑπÏÖò -->
            <div class="admin-section">
                <h2 class="section-title">Add Member</h2>
                <form id="memberAddForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="memberName">Name</label>
                            <input type="text" id="memberName" required placeholder="Name">
                        </div>
                        <div class="form-group">
                            <label for="memberPosition">Position</label>
                            <input type="text" id="memberPosition" required placeholder="Position">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="memberEmail">Email</label>
                            <input type="email" id="memberEmail" required placeholder="Email">
                        </div>
                        <div class="form-group">
                            <label for="memberImage">Profile Image</label>
                            <div class="file-input-wrapper">
                                <input type="file" id="memberImage" accept="image/*" required style="display: none;">
                                <button type="button" class="custom-file-btn" onclick="document.getElementById('memberImage').click()">Choose File</button>
                                <span id="memberImageName" class="file-name">No file selected</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="button-container">
                            <button type="submit" class="btn btn-success">Add Member</button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- ÌåÄ Î©§Î≤Ñ Î™©Î°ù -->
            <div class="admin-section">
                <h2 class="section-title">Registered Team Members</h2>
                <div id="membersLoader" class="hidden" style="text-align: center; padding: 20px;">
                    <div class="loading"></div> Loading members...
                </div>
                <table class="project-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Position</th>
                            <th>Email</th>
                            <th>Image</th>
                            <th>Manage</th>
                        </tr>
                    </thead>
                    <tbody id="membersList">
                        <!-- ÌåÄ Î©§Î≤Ñ Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ù Ï†ïÎ≥¥ (Ïã§Ï†ú ÏÑúÎπÑÏä§ÏóêÏÑúÎäî ÏÑúÎ≤ÑÏóêÏÑú Ï≤òÎ¶¨Ìï¥Ïïº Ìï®)
        const ADMIN_CREDENTIALS = {
            username: 'admin',
            password: '1234'
        };

        let isLoggedIn = false;
        let editingProjectId = null;
        let editingProjectName = null;
        
        // Firebase ÏÉÅÌÉú Ï≤¥ÌÅ¨
        let isFirebaseReady = false;

        // Firebase Ï§ÄÎπÑ ÏÉÅÌÉú ÌôïÏù∏
        function checkFirebaseReady() {
            return new Promise((resolve) => {
                console.log('Firebase Ï§ÄÎπÑ ÏÉÅÌÉú ÌôïÏù∏ ÏãúÏûë');
                console.log('window.db:', window.db);
                console.log('window.firestoreFunctions:', window.firestoreFunctions);
                
                // Ï¶âÏãú ÌôïÏù∏
                if (window.db && window.firestoreFunctions) {
                    isFirebaseReady = true;
                    console.log('Firebase Ï¶âÏãú Ï§ÄÎπÑ ÏôÑÎ£å!');
                    updateFirebaseStatus(true);
                    resolve(true);
                    return;
                }
                
                const checkInterval = setInterval(() => {
                    if (window.db && window.firestoreFunctions) {
                        clearInterval(checkInterval);
                        isFirebaseReady = true;
                        console.log('Firebase Ï§ÄÎπÑ ÏôÑÎ£å!');
                        updateFirebaseStatus(true);
                        resolve(true);
                    }
                }, 100);
                
                // 10Ï¥à ÌõÑ ÌÉÄÏûÑÏïÑÏõÉ
                setTimeout(() => {
                    clearInterval(checkInterval);
                    if (!isFirebaseReady) {
                        console.log('Firebase Ï¥àÍ∏∞Ìôî ÌÉÄÏûÑÏïÑÏõÉ');
                        updateFirebaseStatus(false, 'Firebase Ï¥àÍ∏∞Ìôî ÌÉÄÏûÑÏïÑÏõÉ');
                        resolve(false);
                    }
                }, 10000);
            });
        }

        // Firebase ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        function updateFirebaseStatus(connected, errorMsg = '') {
            const statusElement = document.getElementById('firebaseStatus');
            if (connected) {
                statusElement.className = 'firebase-status firebase-connected';
                statusElement.textContent = 'üî• Firebase Ïó∞Í≤∞Îê® - Ïò®ÎùºÏù∏ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÏÇ¨Ïö© Ï§ë';
            } else {
                statusElement.className = 'firebase-status firebase-error';
                statusElement.textContent = `‚ùå Firebase Ïó∞Í≤∞ Ïã§Ìå®: ${errorMsg || 'Firebase ÏÑ§Ï†ïÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî'}`;
            }
        }

        // Firestore Î≥¥Ïïà Í∑úÏπô ÏïàÎÇ¥
        function showFirestoreRulesHelp() {
            const helpText = `
Firestore Î≥¥Ïïà Í∑úÏπô Î¨∏Ï†úÏùº Ïàò ÏûàÏäµÎãàÎã§. 
Firebase Console > Firestore Database > RulesÏóêÏÑú Îã§Ïùå Í∑úÏπôÏùÑ ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî:

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}

‚ö†Ô∏è Ï£ºÏùò: Ïù¥ Í∑úÏπôÏùÄ Î™®Îì† Ï†ëÍ∑ºÏùÑ ÌóàÏö©Ìï©ÎãàÎã§. ÌîÑÎ°úÎçïÏÖòÏóêÏÑúÎäî Îçî ÏóÑÍ≤©Ìïú Í∑úÏπôÏùÑ ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî.
            `;
            console.log(helpText);
            showAlert('Firestore Î≥¥Ïïà Í∑úÏπôÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî. ÏΩòÏÜîÏóêÏÑú ÏûêÏÑ∏Ìïú ÏïàÎÇ¥Î•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.', 'error');
        }

        // FirestoreÏóêÏÑú ÌîÑÎ°úÏ†ùÌä∏ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ (Í∞ÑÏÜåÌôî Î≤ÑÏ†Ñ)
        async function getProjects() {
            if (!isFirebaseReady) {
                console.log('FirebaseÍ∞Ä Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return {};
            }

            try {
                const { collection, getDocs } = window.firestoreFunctions;
                
                // Í∞ÑÎã®Ìïú Ïª¨Î†âÏÖò ÏùΩÍ∏∞Î°ú Î≥ÄÍ≤Ω (orderBy Ï†úÍ±∞)
                const querySnapshot = await getDocs(collection(window.db, "projects"));
                
                const projects = {};
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    projects[data.name] = {
                        id: doc.id,
                        ...data
                    };
                });
                
                console.log('FirestoreÏóêÏÑú ÌîÑÎ°úÏ†ùÌä∏ Í∞ÄÏ†∏Ïò§Í∏∞ ÏÑ±Í≥µ:', Object.keys(projects).length + 'Í∞ú');
                return projects;
            } catch (error) {
                console.error('Firestore ÌîÑÎ°úÏ†ùÌä∏ Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®:', error);
                console.error('ÏóêÎü¨ ÏÑ∏Î∂ÄÏÇ¨Ìï≠:', error);
                
                // ÏóêÎü¨Í∞Ä Í∂åÌïú Í¥ÄÎ†®Ïù∏ÏßÄ ÌôïÏù∏
                if (error.code === 'permission-denied') {
                    showAlert('Firestore Ï†ëÍ∑º Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§. Î≥¥Ïïà Í∑úÏπôÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                } else {
                    showAlert('ÌîÑÎ°úÏ†ùÌä∏Î•º Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + error.message, 'error');
                }
                return {};
            }
        }

        // Í∞úÎ≥Ñ ÌîÑÎ°úÏ†ùÌä∏ Ï†ÄÏû• (Í∞ïÌôîÎêú Í≤ÄÏ¶ù)
        async function saveProjectToFirestore(projectData) {
            if (!isFirebaseReady) {
                throw new Error('FirebaseÍ∞Ä Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
            }

            try {
                const { collection, addDoc } = window.firestoreFunctions;
                
                // ÏÉùÏÑ± ÏãúÍ∞Ñ Ï∂îÍ∞Ä
                projectData.createdAt = new Date();
                projectData.updatedAt = new Date();
                
                // ÏµúÏ¢Ö Îç∞Ïù¥ÌÑ∞ Í≤ÄÏ¶ù
                const finalData = { ...projectData };
                
                // base64 Îç∞Ïù¥ÌÑ∞ ÏµúÏ¢Ö Ï†úÍ±∞
                if (finalData.mainImage && finalData.mainImage.startsWith('data:')) {
                    console.warn('Firestore Ï†ÄÏû• Ï†Ñ: Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ base64 Ï†úÍ±∞');
                    finalData.mainImage = null;
                }
                if (finalData.images) {
                    finalData.images = finalData.images.filter(url => !url.startsWith('data:'));
                }
                if (finalData.additionalImages) {
                    finalData.additionalImages = finalData.additionalImages.filter(url => !url.startsWith('data:'));
                }
                
                // Îç∞Ïù¥ÌÑ∞ ÌÅ¨Í∏∞ ÌôïÏù∏
                const dataSize = JSON.stringify(finalData).length;
                console.log('Firestore Ï†ÄÏû• ÏãúÎèÑ - Ïª¨Î†âÏÖò: projects');
                console.log('ÏµúÏ¢Ö Îç∞Ïù¥ÌÑ∞ ÌÅ¨Í∏∞:', dataSize, 'bytes');
                console.log('ÎÑ§Ìä∏ÏõåÌÅ¨ ÏÉÅÌÉú:', navigator.onLine);
                console.log('Firebase Ïó∞Í≤∞ ÏÉÅÌÉú:', isFirebaseReady);
                
                if (dataSize > 1000000) {
                    throw new Error(`Îç∞Ïù¥ÌÑ∞ ÌÅ¨Í∏∞Í∞Ä 1MBÎ•º Ï¥àÍ≥ºÌï©ÎãàÎã§: ${(dataSize / 1024 / 1024).toFixed(2)}MB`);
                }
                
                const docRef = await addDoc(collection(window.db, "projects"), finalData);
                console.log('Firestore ÌîÑÎ°úÏ†ùÌä∏ Ï†ÄÏû• ÏÑ±Í≥µ. Î¨∏ÏÑú ID:', docRef.id);
                return docRef.id;
            } catch (error) {
                console.error('Firestore ÌîÑÎ°úÏ†ùÌä∏ Ï†ÄÏû• Ïã§Ìå®:', error);
                console.error('ÏóêÎü¨ ÏΩîÎìú:', error.code);
                console.error('ÏóêÎü¨ Î©îÏãúÏßÄ:', error.message);
                console.error('ÏóêÎü¨ Ïä§ÌÉù:', error.stack);
                
                // Í∂åÌïú Í¥ÄÎ†® ÏóêÎü¨Ïù∏ÏßÄ ÌôïÏù∏
                if (error.code === 'permission-denied') {
                    showFirestoreRulesHelp();
                    throw new Error('Firestore Ï†ëÍ∑º Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§. Î≥¥Ïïà Í∑úÏπôÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                } else if (error.code === 'resource-exhausted') {
                    throw new Error('Firestore Ï†ÄÏû• Í≥µÍ∞ÑÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§.');
                } else if (error.code === 'invalid-argument') {
                    throw new Error('ÏûòÎ™ªÎêú Îç∞Ïù¥ÌÑ∞ ÌòïÏãùÏûÖÎãàÎã§.');
                } else if (error.code === 'unavailable') {
                    throw new Error('Firestore ÏÑúÎπÑÏä§Í∞Ä ÏùºÏãúÏ†ÅÏúºÎ°ú ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§.');
                } else if (error.code === 'deadline-exceeded') {
                    throw new Error('ÏöîÏ≤≠ ÏãúÍ∞ÑÏù¥ Ï¥àÍ≥ºÎêòÏóàÏäµÎãàÎã§.');
                }
                
                throw error;
            }
        }

        // ÌîÑÎ°úÏ†ùÌä∏ ÏóÖÎç∞Ïù¥Ìä∏
        async function updateProjectInFirestore(projectId, projectData) {
            if (!isFirebaseReady) {
                throw new Error('FirebaseÍ∞Ä Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
            }

            try {
                const { doc, updateDoc } = window.firestoreFunctions;
                
                // ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÍ∞Ñ Ï∂îÍ∞Ä
                projectData.updatedAt = new Date();
                
                await updateDoc(doc(window.db, "projects", projectId), projectData);
                console.log('Firestore ÌîÑÎ°úÏ†ùÌä∏ ÏóÖÎç∞Ïù¥Ìä∏ ÏÑ±Í≥µ. Î¨∏ÏÑú ID:', projectId);
            } catch (error) {
                console.error('Firestore ÌîÑÎ°úÏ†ùÌä∏ ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®:', error);
                throw error;
            }
        }

        // ÌîÑÎ°úÏ†ùÌä∏ ÏÇ≠Ï†ú
        async function deleteProjectFromFirestore(projectId) {
            if (!isFirebaseReady) {
                throw new Error('FirebaseÍ∞Ä Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
            }

            try {
                const { doc, deleteDoc } = window.firestoreFunctions;
                await deleteDoc(doc(window.db, "projects", projectId));
                console.log('Firestore ÌîÑÎ°úÏ†ùÌä∏ ÏÇ≠Ï†ú ÏÑ±Í≥µ. Î¨∏ÏÑú ID:', projectId);
            } catch (error) {
                console.error('Firestore ÌîÑÎ°úÏ†ùÌä∏ ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                throw error;
            }
        }

        // ÏïåÎ¶º Î©îÏãúÏßÄ ÌëúÏãú
        function showAlert(message, type = 'success') {
            const alertElement = document.getElementById('alertMessage');
            alertElement.textContent = message;
            alertElement.className = `alert alert-${type}`;
            alertElement.classList.remove('hidden');
            
            setTimeout(() => {
                alertElement.classList.add('hidden');
            }, 5000);
        }

        // Î°úÎî© ÏÉÅÌÉú ÌÜ†Í∏Ä (Í∞ÑÏÜåÌôî)
        function toggleSubmitLoading(loading) {
            const submitBtn = document.getElementById('submitBtn');
            
            if (loading) {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Ï≤òÎ¶¨ Ï§ë...';
            } else {
                submitBtn.disabled = false;
                submitBtn.textContent = editingProjectName ? 'Modify Project' : 'Add Project';
            }
        }

        // Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                isLoggedIn = true;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('adminDashboard').classList.remove('hidden');
                
                // Firebase Ï§ÄÎπÑ ÌôïÏù∏ ÌõÑ ÌîÑÎ°úÏ†ùÌä∏ÏôÄ Î©§Î≤Ñ Î°úÎìú
                checkFirebaseReady().then(() => {
                    loadProjects();
                    loadMembers(); // ÌåÄ Î©§Î≤Ñ Î™©Î°ùÎèÑ Ìï®Íªò Î°úÎìú
                });
            } else {
                const loginAlert = document.getElementById('loginAlert');
                loginAlert.textContent = 'Invalid username or password.';
                loginAlert.classList.remove('hidden');
            }
        });

        // Î°úÍ∑∏ÏïÑÏõÉ Ï≤òÎ¶¨
        document.getElementById('logoutBtn').addEventListener('click', function() {
            isLoggedIn = false;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('loginAlert').classList.add('hidden');
        });

        // Ï∂îÍ∞Ä Ïù¥ÎØ∏ÏßÄ Í¥ÄÎ¶¨ Î≥ÄÏàò
        let additionalImages = []; // Ï∂îÍ∞Ä Ïù¥ÎØ∏ÏßÄ Î∞∞Ïó¥ Ï∂îÍ∞Ä
        let draggedElement = null;

        // ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÎäî base64 Ìï®Ïàò Ï†úÍ±∞Îê®

        // Firebase StorageÏóê Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Ìï®Ïàò (ÏµúÏ†ÅÌôîÎêú Î∞©Ïãù)
        async function uploadImageToStorage(file, folder = 'images') {
            try {
                // ÌååÏùº ÌÅ¨Í∏∞ ÌôïÏù∏
                const fileSizeMB = file.size / (1024 * 1024);
                console.log(`ÏóÖÎ°úÎìú ÏãúÏûë: ${file.name} (${fileSizeMB.toFixed(2)}MB)`);
                
                // ÌååÏùº ÌÅ¨Í∏∞ Ï†úÌïú (100MB)
                if (fileSizeMB > 100) {
                    throw new Error(`ÌååÏùº ÌÅ¨Í∏∞Í∞Ä ÎÑàÎ¨¥ ÌÅΩÎãàÎã§: ${fileSizeMB.toFixed(2)}MB (ÏµúÎåÄ 100MB)`);
                }
                
                // Ïù¥ÎØ∏ÏßÄ ÌíàÏßà Í≤ÄÏÇ¨
                const imageQuality = await checkImageQuality(file);
                if (imageQuality.isLowQuality) {
                    console.warn(`‚ö†Ô∏è Ïù¥ÎØ∏ÏßÄ ÌíàÏßàÏù¥ ÎÇÆÏäµÎãàÎã§: ${imageQuality.width}x${imageQuality.height}px`);
                    console.warn(`üí° Í∂åÏû•: ÏµúÏÜå 1920x1080px, ÌòÑÏû¨: ${imageQuality.width}x${imageQuality.height}px`);
                } else {
                    console.log(`‚úÖ Ïù¥ÎØ∏ÏßÄ ÌíàÏßà ÏñëÌò∏: ${imageQuality.width}x${imageQuality.height}px`);
                }
                
                // ÌååÏùºÎ™Ö ÏÉùÏÑ± (ÌÉÄÏûÑÏä§ÌÉ¨ÌîÑ + ÏõêÎ≥∏ ÌååÏùºÎ™Ö)
                const timestamp = Date.now();
                const fileName = `${folder}/${timestamp}_${file.name}`;
                
                // Firebase Storage Ï∞∏Ï°∞ ÏÉùÏÑ±
                const { ref, uploadBytes, getDownloadURL } = window.storageFunctions;
                const storageRef = ref(window.storage, fileName);
                
                // ÏóÖÎ°úÎìú ÏßÑÌñâÎ•† ÌëúÏãú
                console.log('Firebase Storage ÏóÖÎ°úÎìú ÏãúÏûë...');
                
                // ÏõêÎ≥∏ ÌååÏùº Í∑∏ÎåÄÎ°ú ÏóÖÎ°úÎìú
                const snapshot = await uploadBytes(storageRef, file);
                console.log('Firebase Storage ÏóÖÎ°úÎìú ÏôÑÎ£å:', fileName);
                console.log('ÏóÖÎ°úÎìúÎêú Î∞îÏù¥Ìä∏:', snapshot.bytesTransferred);
                
                // Îã§Ïö¥Î°úÎìú URL Í∞ÄÏ†∏Ïò§Í∏∞
                const downloadURL = await getDownloadURL(snapshot.ref);
                console.log('Îã§Ïö¥Î°úÎìú URL ÏÉùÏÑ± ÏôÑÎ£å:', downloadURL);
                
                return downloadURL;
            } catch (error) {
                console.error('Firebase Storage ÏóÖÎ°úÎìú Ïã§Ìå®:', error);
                
                // Íµ¨Ï≤¥Ï†ÅÏù∏ ÏóêÎü¨ Î©îÏãúÏßÄ
                if (error.code === 'storage/unauthorized') {
                    throw new Error('Firebase Storage Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§. Î≥¥Ïïà Í∑úÏπôÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                } else if (error.code === 'storage/quota-exceeded') {
                    throw new Error('Firebase Storage Ïö©ÎüâÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§.');
                } else if (error.code === 'storage/retry-limit-exceeded') {
                    throw new Error('ÏóÖÎ°úÎìú Ïû¨ÏãúÎèÑ ÌïúÎèÑÎ•º Ï¥àÍ≥ºÌñàÏäµÎãàÎã§. ÎÑ§Ìä∏ÏõåÌÅ¨Î•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                } else if (error.code === 'storage/invalid-checksum') {
                    throw new Error('ÌååÏùºÏù¥ ÏÜêÏÉÅÎêòÏóàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                } else {
                    throw new Error(`ÏóÖÎ°úÎìú Ïã§Ìå®: ${error.message}`);
                }
            }
        }

        // ÌîÑÎ°úÏ†ùÌä∏ Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞ Î∂ÑÎ¶¨ Ìï®Ïàò (ÏôÑÏ†Ñ ÏÉàÎ°úÏö¥ Î∞©Ïãù)
        function createCleanProjectData(projectInfo, imageUrls) {
            // FirestoreÏóê Ï†ÄÏû•Ìï† Íπ®ÎÅóÌïú Îç∞Ïù¥ÌÑ∞Îßå ÏÉùÏÑ±
            const cleanData = {
                name: projectInfo.name,
                category: projectInfo.category,
                location: projectInfo.location,
                year: projectInfo.year ? parseInt(projectInfo.year) : null,
                status: projectInfo.status,
                client: projectInfo.client,
                service: projectInfo.service,
                categoryDetail: projectInfo.categoryDetail,
                createdAt: new Date(),
                updatedAt: new Date()
            };
            
            // Ïù¥ÎØ∏ÏßÄ URLÎì§Îßå Ï∂îÍ∞Ä (base64Í∞Ä ÏïÑÎãå Í≤ΩÏö∞Îßå)
            if (imageUrls.mainImage && !imageUrls.mainImage.startsWith('data:')) {
                cleanData.mainImage = imageUrls.mainImage;
            }
            
            if (imageUrls.additionalImages && imageUrls.additionalImages.length > 0) {
                cleanData.additionalImages = imageUrls.additionalImages.filter(url => !url.startsWith('data:'));
            }
            
            // Îç∞Ïù¥ÌÑ∞ ÌÅ¨Í∏∞ ÌôïÏù∏
            const dataSize = JSON.stringify(cleanData).length;
            console.log('Íπ®ÎÅóÌïú ÌîÑÎ°úÏ†ùÌä∏ Îç∞Ïù¥ÌÑ∞ ÌÅ¨Í∏∞:', dataSize, 'bytes');
            
            if (dataSize > 1000000) {
                throw new Error(`Îç∞Ïù¥ÌÑ∞ ÌÅ¨Í∏∞Í∞Ä 1MBÎ•º Ï¥àÍ≥ºÌï©ÎãàÎã§: ${(dataSize / 1024 / 1024).toFixed(2)}MB`);
            }
            
            return cleanData;
        }



        // Ï∂îÍ∞Ä Ïù¥ÎØ∏ÏßÄ ÌååÏùºÎ™Ö ÌëúÏãú
        document.getElementById('additionalImages').addEventListener('change', function() {
            const files = this.files;
            const fileNameSpan = document.getElementById('additionalImagesName');
            if (files.length > 0) {
                if (files.length === 1) {
                    fileNameSpan.textContent = files[0].name;
                } else {
                    fileNameSpan.textContent = `${files.length} files selected`;
                }
            } else {
                fileNameSpan.textContent = 'No files selected';
            }
        });

        // Ï∂îÍ∞Ä Ïù¥ÎØ∏ÏßÄ ÏûêÎèô Ï∂îÍ∞Ä Ìï®Ïàò ÏàòÏ†ï (Firebase Storage ÏÇ¨Ïö©)
        document.getElementById('additionalImages').addEventListener('change', async function() {
            const files = this.files;
            
            if (files.length === 0) return;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const imageId = Date.now() + '-additional-' + i;
                
                try {
                    // Firebase StorageÏóê ÏóÖÎ°úÎìú
                    const downloadURL = await uploadImageToStorage(file, 'additional-images');
                    
                    additionalImages.push({
                        id: imageId,
                        file: file,
                        url: downloadURL // Storage URL Ï†ÄÏû•
                    });
                    
                    console.log('Ï∂îÍ∞Ä Ïù¥ÎØ∏ÏßÄ ÏõêÎ≥∏ ÏóÖÎ°úÎìú ÏôÑÎ£å:', downloadURL);
                } catch (error) {
                    console.error('Ï∂îÍ∞Ä Ïù¥ÎØ∏ÏßÄ Ï≤òÎ¶¨ Ïã§Ìå®:', error);
                    alert('Error processing image: ' + file.name);
                }
            }
            
            renderAdditionalPreview();
            this.value = ''; // Í∞ôÏùÄ ÌååÏùºÏùÑ Îã§Ïãú ÏÑ†ÌÉùÌï† Ïàò ÏûàÎèÑÎ°ù Ï¥àÍ∏∞Ìôî
        });



        // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Í∏∞Îä• (Ï∂îÍ∞Ä Ïù¥ÎØ∏ÏßÄÏö©)
        function addDragDropEvents() {
            const items = document.querySelectorAll('.additional-preview-item');
            
            items.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('drop', handleDrop);
                item.addEventListener('dragend', handleDragEnd);
            });
        }

        function handleDragStart(e) {
            draggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDrop(e) {
            e.preventDefault();
            
            if (this !== draggedElement) {
                const draggedIndex = parseInt(draggedElement.dataset.index);
                const targetIndex = parseInt(this.dataset.index);
                
                // Î∞∞Ïó¥ÏóêÏÑú ÏúÑÏπò Î≥ÄÍ≤Ω
                const draggedItem = additionalImages[draggedIndex];
                additionalImages.splice(draggedIndex, 1);
                additionalImages.splice(targetIndex, 0, draggedItem);
                
                renderAdditionalPreview();
            }
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            draggedElement = null;
        }



        // localStorage base64 Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨ Ìï®Ïàò (Í∞ïÌôî)
        function cleanupLocalStorage() {
            try {
                console.log('localStorage base64 Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨ ÏãúÏûë...');
                
                // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ
                const adminProjects = localStorage.getItem('adminProjects');
                const projects = localStorage.getItem('projects');
                
                if (adminProjects) {
                    const parsed = JSON.parse(adminProjects);
                    const cleaned = {};
                    
                    Object.keys(parsed).forEach(key => {
                        const project = parsed[key];
                        cleaned[key] = {
                            ...project,
                            mainImage: project.mainImage && project.mainImage.startsWith('data:') ? null : project.mainImage,
                            images: project.images ? project.images.filter(img => !img.startsWith('data:')) : [],
                            additionalImages: project.additionalImages ? project.additionalImages.filter(img => !img.startsWith('data:')) : []
                        };
                    });
                    
                    localStorage.setItem('adminProjects', JSON.stringify(cleaned));
                    console.log('adminProjects base64 Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨ ÏôÑÎ£å');
                }
                
                if (projects) {
                    const parsed = JSON.parse(projects);
                    const cleaned = parsed.map(project => ({
                        ...project,
                        mainImage: project.mainImage && project.mainImage.startsWith('data:') ? null : project.mainImage,
                        images: project.images ? project.images.filter(img => !img.startsWith('data:')) : [],
                        additionalImages: project.additionalImages ? project.additionalImages.filter(img => !img.startsWith('data:')) : []
                    }));
                    
                    localStorage.setItem('projects', JSON.stringify(cleaned));
                    console.log('projects base64 Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨ ÏôÑÎ£å');
                }
                
                // Ï∂îÍ∞Ä Ï†ïÎ¶¨: Î™®Îì† localStorage ÌÇ§ ÌôïÏù∏
                const allKeys = Object.keys(localStorage);
                allKeys.forEach(key => {
                    if (key.includes('project') || key.includes('admin')) {
                        try {
                            const data = JSON.parse(localStorage.getItem(key));
                            if (typeof data === 'object' && data !== null) {
                                // base64 Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÎäîÏßÄ ÌôïÏù∏
                                const hasBase64 = JSON.stringify(data).includes('data:image');
                                if (hasBase64) {
                                    console.log(`Í≤ΩÍ≥†: ${key}Ïóê base64 Îç∞Ïù¥ÌÑ∞Í∞Ä Ìè¨Ìï®ÎêòÏñ¥ ÏûàÏäµÎãàÎã§.`);
                                }
                            }
                        } catch (e) {
                            // JSONÏù¥ ÏïÑÎãå Í≤ΩÏö∞ Î¨¥Ïãú
                        }
                    }
                });
                
                console.log('localStorage base64 Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨ ÏôÑÎ£å');
            } catch (error) {
                console.error('localStorage Ï†ïÎ¶¨ Ïã§Ìå®:', error);
            }
        }



        // localStorage Ïö©Îüâ ÌôïÏù∏ Ìï®Ïàò
        function checkLocalStorageSize() {
            const projects = localStorage.getItem('projects');
            const adminProjects = localStorage.getItem('adminProjects');
            
            if (projects) {
                const sizeKB = (projects.length / 1024).toFixed(2);
                console.log(`projects ÌÅ¨Í∏∞: ${sizeKB}KB`);
            }
            
            if (adminProjects) {
                const sizeKB = (adminProjects.length / 1024).toFixed(2);
                console.log(`adminProjects ÌÅ¨Í∏∞: ${sizeKB}KB`);
            }
            
            // Ï†ÑÏ≤¥ localStorage ÏÇ¨Ïö©Îüâ ÌôïÏù∏
            let totalSize = 0;
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    totalSize += localStorage[key].length;
                }
            }
            console.log(`Ï†ÑÏ≤¥ localStorage ÏÇ¨Ïö©Îüâ: ${(totalSize / 1024).toFixed(2)}KB`);
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî - Í∞ÑÏÜåÌôî
        document.addEventListener('DOMContentLoaded', function() {
            // localStorage Ïö©Îüâ ÌôïÏù∏
            checkLocalStorageSize();
            
            // localStorage base64 Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨
            cleanupLocalStorage();
            

            renderAdditionalPreview();
            
            // Firebase Ï¥àÍ∏∞Ìôî Ï≤¥ÌÅ¨
            checkFirebaseReady();
            
            console.log('Admin panel initialization completed'); // ÎîîÎ≤ÑÍπÖÏö©
        });

        // ÏàòÏ†ï Î≤ÑÌäº ÌÅ¥Î¶≠ Ìï∏Îì§Îü¨ (Î°úÎî© ÏÉÅÌÉú Í¥ÄÎ¶¨)
        async function handleEditProject(buttonElement, projectName) {
            const originalText = buttonElement.textContent;
            buttonElement.disabled = true;
            buttonElement.textContent = 'Loading...';
            
            try {
                await editProject(projectName);
            } catch (error) {
                console.error('ÌîÑÎ°úÏ†ùÌä∏ ÏàòÏ†ï Ïã§Ìå®:', error);
                showAlert('Failed to modify project.', 'error');
            } finally {
                buttonElement.disabled = false;
                buttonElement.textContent = originalText;
            }
        }

        // ÌîÑÎ°úÏ†ùÌä∏ ÏàòÏ†ï Ìï®Ïàò ÏàòÏ†ï (Î°úÎî© Î¨∏Ï†ú Ìï¥Í≤∞)
        async function editProject(projectName) {
            try {
                // FirebaseÍ∞Ä Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏúºÎ©¥ localStorageÏóêÏÑú Í∞ÄÏ†∏Ïò§Í∏∞
                let firestoreProjects = {};
                
                if (isFirebaseReady) {
                    // ÌÉÄÏûÑÏïÑÏõÉ ÏÑ§Ï†ï (3Ï¥à)
                    const timeoutPromise = new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('Timeout')), 3000)
                    );
                    
                    try {
                        firestoreProjects = await Promise.race([getProjects(), timeoutPromise]);
                    } catch (error) {
                        console.log('Failed to get from Firestore, using localStorage:', error.message);
                        // Firestore Ïã§Ìå®Ïãú localStorageÏóêÏÑú Í∞ÄÏ†∏Ïò§Í∏∞
                        const localProjects = localStorage.getItem('adminProjects');
                        firestoreProjects = localProjects ? JSON.parse(localProjects) : {};
                    }
                } else {
                    // FirebaseÍ∞Ä Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏúºÎ©¥ localStorageÏóêÏÑú Í∞ÄÏ†∏Ïò§Í∏∞
                    console.log('Firebase not ready, using localStorage');
                    const localProjects = localStorage.getItem('adminProjects');
                    firestoreProjects = localProjects ? JSON.parse(localProjects) : {};
                }
                
                const project = firestoreProjects[projectName];
                
                if (!project) {
                    console.log('ÌîÑÎ°úÏ†ùÌä∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§:', projectName);
                    showAlert('Project not found.', 'error');
                    return;
                }

                console.log('ÏàòÏ†ïÌï† ÌîÑÎ°úÏ†ùÌä∏ Îç∞Ïù¥ÌÑ∞:', project);

                editingProjectId = project.id;
                editingProjectName = projectName;
                
                // Í∏∞Î≥∏ Ï†ïÎ≥¥ ÏûÖÎ†•
                document.getElementById('projectName').value = project.name || '';
                document.getElementById('projectCategory').value = project.category || '';
                document.getElementById('projectLocation').value = project.location || '';
                document.getElementById('projectYear').value = project.year || '';
                document.getElementById('projectStatus').value = project.status || 'In Planning';
                document.getElementById('projectName').value = project.name || '';
                document.getElementById('projectClient').value = project.client || '';
                document.getElementById('projectLocation').value = project.location || '';
                document.getElementById('projectService').value = project.service || '';
                
                // ÏàòÏ†ï Î™®ÎìúÏóêÏÑúÎäî Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ required ÏÜçÏÑ± Ï†úÍ±∞
                const mainImageInput = document.getElementById('projectImage');
                mainImageInput.removeAttribute('required');
                
                // Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞
                const mainImagePreview = document.getElementById('mainImagePreview');
                if (project.mainImage) {
                    const img = document.createElement('img');
                    img.src = project.mainImage;
                    img.alt = 'Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞';
                    mainImagePreview.innerHTML = '';
                    mainImagePreview.appendChild(img);
                    
                    // Í∏∞Ï°¥ Ïù¥ÎØ∏ÏßÄÎ•º datasetÏóê Ï†ÄÏû• (Ìèº Ï†úÏ∂ú Ïãú ÏÇ¨Ïö©)
                    mainImagePreview.dataset.storageUrl = project.mainImage;
                } else {
                    mainImagePreview.innerHTML = '';
                    delete mainImagePreview.dataset.storageUrl;
                }
                
                
                
                // Ï∂îÍ∞Ä Ïù¥ÎØ∏ÏßÄÎì§ Î∂àÎü¨Ïò§Í∏∞ (base64 Ï†úÏô∏)
                additionalImages = [];
                if (project.additionalImages && Array.isArray(project.additionalImages)) {
                    project.additionalImages
                        .filter(imageUrl => imageUrl && !imageUrl.startsWith('data:')) // base64 Ï†úÏô∏
                        .forEach((imageUrl, index) => {
                        additionalImages.push({
                            id: 'existing-additional-' + index,
                            file: null,
                            url: imageUrl
                        });
                    });
                }
                console.log('ÏàòÏ†ï Î™®Îìú - Ï∂îÍ∞Ä Ïù¥ÎØ∏ÏßÄ Î°úÎìú:', additionalImages.length, 'Í∞ú (base64 Ï†úÏô∏)');
                renderAdditionalPreview();
                
                // Ïπ¥ÌÖåÍ≥†Î¶¨ Ï≤¥ÌÅ¨Î∞ïÏä§ Ï±ÑÏö∞Í∏∞ (Î∞∞Ïó¥/Î¨∏ÏûêÏó¥ Î™®Îëê ÎåÄÏùë)
                const checkboxes = document.querySelectorAll('input[name="projectCategories"]');
                checkboxes.forEach(cb => cb.checked = false);
                let categories = project.category;
                if (!Array.isArray(categories)) {
                    categories = categories ? [categories] : [];
                }
                categories.forEach(cat => {
                    const checkbox = document.querySelector(`input[name="projectCategories"][value="${cat}"]`);
                    if (checkbox) checkbox.checked = true;
                });
                
                // ÌïòÏù¥ÎùºÏù¥Ìä∏ Ï≤¥ÌÅ¨Î∞ïÏä§ Ï†úÍ±∞Îê®

                // ÏàòÏ†ï Î™®Îìú UI ÌëúÏãú
                document.getElementById('cancelEdit').classList.remove('hidden');
                
                // Î≤ÑÌäº ÌÖçÏä§Ìä∏ Î≥ÄÍ≤Ω
                const submitBtn = document.getElementById('submitBtn');
                submitBtn.textContent = 'Modify Project';
                
                // ÌèºÏúºÎ°ú Ïä§ÌÅ¨Î°§
                document.querySelector('.admin-section').scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('ÌîÑÎ°úÏ†ùÌä∏ ÏàòÏ†ï Î°úÎìú Ïã§Ìå®:', error);
                showAlert('Failed to load project information.', 'error');
            }
        }

        // ÏàòÏ†ï Ï∑®ÏÜå Î≤ÑÌäº ÏàòÏ†ï
        document.getElementById('cancelEdit').addEventListener('click', function() {
            editingProjectId = null;
            editingProjectName = null;
            
            // Ìèº Ï¥àÍ∏∞Ìôî
            document.getElementById('projectForm').reset();
            
            // ÏÉà ÌîÑÎ°úÏ†ùÌä∏ Ï∂îÍ∞Ä Î™®ÎìúÎ°ú ÎèåÏïÑÍ∞à Îïå required ÏÜçÏÑ± Îã§Ïãú Ï∂îÍ∞Ä
            const mainImageInput = document.getElementById('projectImage');
            mainImageInput.setAttribute('required', 'required');
            
            // Ïù¥ÎØ∏ÏßÄ Î∞∞Ïó¥ Ï¥àÍ∏∞Ìôî
            additionalImages = [];
            
            // ÎØ∏Î¶¨Î≥¥Í∏∞ Ï¥àÍ∏∞Ìôî
            renderAdditionalPreview();
            document.getElementById('mainImagePreview').innerHTML = '';
            
            // UI Ï¥àÍ∏∞Ìôî
            this.classList.add('hidden');
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.textContent = 'ÌîÑÎ°úÏ†ùÌä∏ Ï∂îÍ∞Ä';
        });

        // ÌîÑÎ°úÏ†ùÌä∏ Ìèº Ï†úÏ∂ú Ï≤òÎ¶¨ - Firebase Î≤ÑÏ†Ñ
        document.getElementById('projectForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            toggleSubmitLoading(true);
            
            console.log('=== ÌîÑÎ°úÏ†ùÌä∏ Ï†ÄÏû• ÏãúÏûë ===');
            console.log('Firebase ÏÉÅÌÉú:', isFirebaseReady);
            console.log('Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú:', isLoggedIn);
            console.log('window.db:', window.db);
            console.log('window.firestoreFunctions:', window.firestoreFunctions);
            
            try {
                // Ìèº Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
                const projectName = document.getElementById('projectName').value;
                const projectCategory = document.getElementById('projectCategory').value;
                const projectLocation = document.getElementById('projectLocation').value;
                const projectYear = document.getElementById('projectYear').value;
                const projectStatus = document.getElementById('projectStatus').value;
                const projectClient = document.getElementById('projectClient').value;
                const projectService = document.getElementById('projectService').value;
                
                // === ÏôÑÏ†Ñ ÏÉàÎ°úÏö¥ Î∞©Ïãù: Îã®Í≥ÑÎ≥Ñ Ï≤òÎ¶¨ ===
                console.log('=== ÏÉàÎ°úÏö¥ Î∞©ÏãùÏúºÎ°ú ÌîÑÎ°úÏ†ùÌä∏ Ï†ÄÏû• ÏãúÏûë ===');
                
                // 1Îã®Í≥Ñ: Í∏∞Î≥∏ ÌîÑÎ°úÏ†ùÌä∏ Ï†ïÎ≥¥ ÏàòÏßë
                const projectInfo = {
                    name: projectName,
                    category: projectCategory,
                    location: projectLocation,
                    year: projectYear ? parseInt(projectYear) : null,
                    status: projectStatus,
                    client: projectClient,
                    service: projectService,
                    categoryDetail: Array.from(document.querySelectorAll('input[name="projectCategories"]:checked')).map(cb => cb.value)
                };
                
                // 2Îã®Í≥Ñ: Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Ï≤òÎ¶¨
                const imageUrls = {
                    mainImage: null,
                    additionalImages: []
                };
                
                // Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ Ï≤òÎ¶¨
                const mainImageFile = document.getElementById('projectImage').files[0];
                const previewContainer = document.getElementById('mainImagePreview');
                
                if (mainImageFile) {
                    // ÏÉà Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú
                    try {
                        imageUrls.mainImage = await uploadImageToStorage(mainImageFile, 'main-images');
                        console.log('Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú ÏôÑÎ£å:', imageUrls.mainImage);
                    } catch (error) {
                        console.error('Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Ïã§Ìå®:', error);
                        throw new Error('Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìúÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                    }
                } else if (previewContainer.dataset.storageUrl) {
                    // Í∏∞Ï°¥ Ïù¥ÎØ∏ÏßÄ ÏÇ¨Ïö©
                    const existingUrl = previewContainer.dataset.storageUrl;
                    if (existingUrl && !existingUrl.startsWith('data:')) {
                        imageUrls.mainImage = existingUrl;
                        console.log('Í∏∞Ï°¥ Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ ÏÇ¨Ïö©:', existingUrl);
                    }
                } else if (!editingProjectName) {
                    throw new Error('Î©îÏù∏ Ïù¥ÎØ∏ÏßÄÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                }
                

                
                // Ï∂îÍ∞Ä Ïù¥ÎØ∏ÏßÄÎì§ Ï≤òÎ¶¨
                for (const addImg of additionalImages) {
                    if (addImg.url && !addImg.url.startsWith('data:')) {
                        imageUrls.additionalImages.push(addImg.url);
                    }
                }
                
                console.log('Ïù¥ÎØ∏ÏßÄ URL ÏàòÏßë ÏôÑÎ£å:');
                console.log('- Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ:', imageUrls.mainImage ? 'ÏûàÏùå' : 'ÏóÜÏùå');
                console.log('- Ï∂îÍ∞Ä Ïù¥ÎØ∏ÏßÄ:', imageUrls.additionalImages.length, 'Í∞ú');
                
                // 3Îã®Í≥Ñ: Íπ®ÎÅóÌïú ÌîÑÎ°úÏ†ùÌä∏ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
                const cleanProjectData = createCleanProjectData(projectInfo, imageUrls);

                // 4Îã®Í≥Ñ: Firebase ÎòêÎäî localStorage Ï†ÄÏû•
                try {
                    console.log('=== Ï†ÄÏû• ÏãúÎèÑ ===');
                    console.log('Firebase Ï§ÄÎπÑ:', isFirebaseReady);
                    console.log('ÏàòÏ†ï Î™®Îìú:', editingProjectId);
                    
                    if (isFirebaseReady && editingProjectId) {
                        // Firebase ÏàòÏ†ï Î™®Îìú
                        console.log('Firebase ÏàòÏ†ï Î™®ÎìúÎ°ú Ï†ÄÏû• ÏãúÎèÑ');
                        await updateProjectInFirestore(editingProjectId, cleanProjectData);
                        showAlert('Project has been successfully modified!');
                    } else if (isFirebaseReady) {
                        // Firebase ÏÉà ÌîÑÎ°úÏ†ùÌä∏ Ï∂îÍ∞Ä
                        console.log('Firebase ÏÉà ÌîÑÎ°úÏ†ùÌä∏ Ï∂îÍ∞Ä ÏãúÎèÑ');
                        const docId = await saveProjectToFirestore(cleanProjectData);
                        showAlert('Project has been successfully added!');
                    } else {
                        // Firebase Ïó∞Í≤∞ ÏïàÎê® - localStorageÎßå ÏÇ¨Ïö©
                        console.log('Firebase Ïó∞Í≤∞ ÏïàÎê®, localStorage ÏÇ¨Ïö©');
                        
                        // localStorageÏóê Ï†ÄÏû• (Í∞ÄÎ≤ºÏö¥ Î≤ÑÏ†ÑÎßå)
                        let localProjects = JSON.parse(localStorage.getItem('adminProjects') || '{}');
                        let projectsArray = JSON.parse(localStorage.getItem('projects') || '[]');
                        
                        if (editingProjectName) {
                            delete localProjects[editingProjectName];
                            projectsArray = projectsArray.filter(p => p.name !== editingProjectName);
                        }
                        
                        // Íπ®ÎÅóÌïú Îç∞Ïù¥ÌÑ∞Îßå Ï†ÄÏû•
                        localProjects[cleanProjectData.name] = cleanProjectData;
                        projectsArray.push(cleanProjectData);
                        
                        // localStorage ÌÅ¨Í∏∞ Í¥ÄÎ¶¨ (Í∞ïÌôî)
                        const totalSize = JSON.stringify(projectsArray).length;
                        console.log('localStorage Ï†ÄÏû• ÌÅ¨Í∏∞:', (totalSize / 1024).toFixed(2), 'KB');
                        
                        // Ïö©Îüâ Ï†úÌïú Ï≤¥ÌÅ¨ (3MBÎ°ú ÎÇÆÏ∂§)
                        if (totalSize > 3000000) { // 3MB Ï†úÌïú
                            console.warn('localStorage Ïö©Îüâ Ï¥àÍ≥º, Ïò§ÎûòÎêú Îç∞Ïù¥ÌÑ∞ Ï†úÍ±∞');
                            
                            // Í∞ÄÏû• Ïò§ÎûòÎêú ÌîÑÎ°úÏ†ùÌä∏Î∂ÄÌÑ∞ Ï†úÍ±∞
                            while (totalSize > 2000000 && projectsArray.length > 1) {
                                const removed = projectsArray.shift();
                                console.log(`Ï†úÍ±∞Îêú ÌîÑÎ°úÏ†ùÌä∏: ${removed.name}`);
                                
                                // ÏÉàÎ°úÏö¥ ÌÅ¨Í∏∞ Í≥ÑÏÇ∞
                                const newSize = JSON.stringify(projectsArray).length;
                                if (newSize >= totalSize) {
                                    console.warn('Î¨¥Ìïú Î£®ÌîÑ Î∞©ÏßÄ, Í∞ïÏ†ú Ï§ëÎã®');
                                    break;
                                }
                                totalSize = newSize;
                            }
                            
                            console.log('Ï†ïÎ¶¨ ÌõÑ ÌÅ¨Í∏∞:', (totalSize / 1024).toFixed(2), 'KB');
                        }
                        
                        // ÏµúÏ¢Ö Ïö©Îüâ ÌôïÏù∏
                        if (totalSize > 5000000) {
                            throw new Error(`localStorage Ïö©ÎüâÏù¥ Ïó¨Ï†ÑÌûà Ï¥àÍ≥ºÎê©ÎãàÎã§: ${(totalSize / 1024 / 1024).toFixed(2)}MB`);
                        }
                        
                        localStorage.setItem('adminProjects', JSON.stringify(localProjects));
                        localStorage.setItem('projects', JSON.stringify(projectsArray));
                        
                        showAlert('Project saved locally! (Will sync when Firebase is connected)', 'success');
                    }
                } catch (error) {
                    console.error('Ï†ÄÏû• Ïã§Ìå®:', error);
                    showAlert('Failed to save project: ' + error.message, 'error');
                }
                
                // ÏàòÏ†ï Î™®Îìú Ï†ïÎ¶¨
                if (editingProjectName) {
                    editingProjectId = null;
                    editingProjectName = null;
                    document.getElementById('cancelEdit').classList.add('hidden');
                    const submitBtn = document.getElementById('submitBtn');
                    submitBtn.textContent = 'ÌîÑÎ°úÏ†ùÌä∏ Ï∂îÍ∞Ä';
                    
                    // required ÏÜçÏÑ± Îã§Ïãú Ï∂îÍ∞Ä
                    const mainImageInput = document.getElementById('projectImage');
                    mainImageInput.setAttribute('required', 'required');
                }
                
                console.log('=== ÌîÑÎ°úÏ†ùÌä∏ Ï†ÄÏû• ÏÑ±Í≥µ ===');
                
                // ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
                loadProjects();
                
                // Ìèº Ï¥àÍ∏∞Ìôî
                document.getElementById('projectForm').reset();
                additionalImages = [];
                renderAdditionalPreview();
                document.getElementById('mainImagePreview').innerHTML = '';
                
                // Ïã§ÏãúÍ∞Ñ Î∞òÏòÅ
                window.dispatchEvent(new Event('adminProjectsUpdated'));
                
            } catch (error) {
                console.error('ÌîÑÎ°úÏ†ùÌä∏ Ï†ÄÏû• Ïã§Ìå®:', error);
                
                if (error.message.includes('quota') || error.message.includes('storage')) {
                    showAlert('Firestore storage is insufficient! Please reduce image size or delete existing projects.', 'error');
                } else {
                    showAlert('Error occurred while saving project: ' + error.message, 'error');
                }
            } finally {
                toggleSubmitLoading(false);
            }
        });

        // Firestore Îç∞Ïù¥ÌÑ∞Î•º localStorageÏóê ÎèôÍ∏∞Ìôî (Ïö©Îüâ Ï≤¥ÌÅ¨ Í∞ïÌôî)
        async function syncToLocalStorage() {
            try {
                const firestoreProjects = await getProjects();
                const projectsArray = Object.values(firestoreProjects);
                
                // base64 Îç∞Ïù¥ÌÑ∞ Ï†úÍ±∞
                const lightProjects = projectsArray.map(project => ({
                    ...project,
                    mainImage: project.mainImage && project.mainImage.startsWith('data:') ? null : project.mainImage,
                    images: project.images ? project.images.filter(img => !img.startsWith('data:')) : [],
                    additionalImages: project.additionalImages ? project.additionalImages.filter(img => !img.startsWith('data:')) : []
                }));
                
                // Ïö©Îüâ Ï≤¥ÌÅ¨
                const dataSize = JSON.stringify(lightProjects).length;
                console.log('ÎèôÍ∏∞Ìôî Îç∞Ïù¥ÌÑ∞ ÌÅ¨Í∏∞:', (dataSize / 1024).toFixed(2), 'KB');
                
                if (dataSize > 3000000) { // 3MB Ï†úÌïú
                    console.warn('localStorage Ïö©Îüâ Ï¥àÍ≥º, ÎèôÍ∏∞ÌôîÎ•º Í±¥ÎÑàÎúÅÎãàÎã§.');
                    return;
                }
                
                localStorage.setItem('projects', JSON.stringify(lightProjects));
                localStorage.setItem('adminProjects', JSON.stringify(lightProjects));
                
                // ÌîÑÎ°úÏ†ùÌä∏ ÌéòÏù¥ÏßÄÏóê Ïã§ÏãúÍ∞Ñ Î∞òÏòÅ
                window.dispatchEvent(new Event('adminProjectsUpdated'));
                
                console.log('localStorage ÎèôÍ∏∞Ìôî ÏôÑÎ£å:', lightProjects.length + 'Í∞ú ÌîÑÎ°úÏ†ùÌä∏');
            } catch (error) {
                console.error('localStorage ÎèôÍ∏∞Ìôî Ïã§Ìå®:', error);
            }
        }

        // ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ù Î°úÎìú - Firebase/localStorage ÌïòÏù¥Î∏åÎ¶¨Îìú
        async function loadProjects() {
            const projectList = document.getElementById('projectList');
            const loader = document.getElementById('projectsLoader');
            
            try {
                loader.classList.remove('hidden');
                projectList.innerHTML = '';

                let projects = {};
                
                if (isFirebaseReady) {
                    try {
                        projects = await getProjects();
                        console.log('FirebaseÏóêÏÑú ÌîÑÎ°úÏ†ùÌä∏ Î°úÎìú ÏÑ±Í≥µ');
                    } catch (error) {
                        console.log('Firebase Î°úÎìú Ïã§Ìå®, localStorage ÏÇ¨Ïö©:', error);
                        const localProjects = localStorage.getItem('adminProjects');
                        projects = localProjects ? JSON.parse(localProjects) : {};
                    }
                } else {
                    console.log('Firebase Ï§ÄÎπÑ ÏïàÎê®, localStorage ÏÇ¨Ïö©');
                    const localProjects = localStorage.getItem('adminProjects');
                    projects = localProjects ? JSON.parse(localProjects) : {};
                }
                
                if (Object.keys(projects).length === 0) {
                    projectList.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #999;">Îì±Î°ùÎêú ÌîÑÎ°úÏ†ùÌä∏Í∞Ä ÏóÜÏäµÎãàÎã§.</td></tr>';
                } else {
                    // ÌîÑÎ°úÏ†ùÌä∏Î•º Ïπ¥ÌÖåÍ≥†Î¶¨Î≥ÑÎ°ú Ï†ïÎ†¨
                    const sortedProjects = Object.entries(projects).sort((a, b) => {
                        const categoryA = a[1].category.toLowerCase();
                        const categoryB = b[1].category.toLowerCase();
                        
                        // ÏïÑÌÇ§ÌÖçÏ≤òÍ∞Ä Î®ºÏ†Ä, Ïù∏ÌÖåÎ¶¨Ïñ¥Í∞Ä ÎÇòÏ§ëÏóê Ïò§ÎèÑÎ°ù Ï†ïÎ†¨
                        if (categoryA === 'architecture' && categoryB !== 'architecture') {
                            return -1;
                        }
                        if (categoryA !== 'architecture' && categoryB === 'architecture') {
                            return 1;
                        }
                        
                        // Í∞ôÏùÄ Ïπ¥ÌÖåÍ≥†Î¶¨ ÎÇ¥ÏóêÏÑúÎäî Ïù¥Î¶ÑÏàú Ï†ïÎ†¨
                        return a[0].localeCompare(b[0]);
                    });
                    
                    sortedProjects.forEach(([projectName, project]) => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${project.name}</td>
                            <td>${project.category.toUpperCase()}</td>
                            <td>${project.location}</td>
                            <td>${project.year || '-'}</td>
                            <td>${project.status}</td>
                            <td>
                                                        <button class="btn-edit" onclick="handleEditProject(this, '${projectName}')">Edit</button>
                        <button class="btn-danger" onclick="deleteProject('${projectName}', '${project.id}')">Delete</button>
                            </td>
                        `;
                        projectList.appendChild(row);
                    });
                }

                // localStorage ÎèôÍ∏∞Ìôî (Ïö©Îüâ Ï≤¥ÌÅ¨ Í∞ïÌôî)
                const projectsArray = Object.values(projects);
                try {
                    // Ïù¥ÎØ∏ÏßÄ URLÎßå Ìè¨Ìï®ÌïòÏó¨ localStorageÏóê Ï†ÄÏû• (base64 Ï†úÏô∏)
                    const lightProjects = projectsArray.map(project => ({
                        ...project,
                        // base64 Îç∞Ïù¥ÌÑ∞Îäî Ï†úÏô∏ÌïòÍ≥† URLÎßå Ï†ÄÏû•
                        mainImage: project.mainImage && project.mainImage.startsWith('data:') ? null : project.mainImage,
                        images: project.images ? project.images.filter(img => !img.startsWith('data:')) : [],
                        additionalImages: project.additionalImages ? project.additionalImages.filter(img => !img.startsWith('data:')) : []
                    }));
                    
                    // Ïö©Îüâ Ï≤¥ÌÅ¨
                    const dataSize = JSON.stringify(lightProjects).length;
                    console.log('localStorage ÎèôÍ∏∞Ìôî ÌÅ¨Í∏∞:', (dataSize / 1024).toFixed(2), 'KB');
                    
                    if (dataSize > 3000000) { // 3MB Ï†úÌïú
                        console.warn('localStorage Ïö©Îüâ Ï¥àÍ≥º, ÎèôÍ∏∞ÌôîÎ•º Í±¥ÎÑàÎúÅÎãàÎã§.');
                        return; // ÎèôÍ∏∞Ìôî Ï§ëÎã®
                    }
                    
                    localStorage.setItem('projects', JSON.stringify(lightProjects));
                    localStorage.setItem('adminProjects', JSON.stringify(lightProjects));
                    console.log('localStorage ÎèôÍ∏∞Ìôî ÏôÑÎ£å (base64 Ï†úÍ±∞Îê®)');
                } catch (e) {
                    console.warn('localStorage Ïö©Îüâ Ï¥àÍ≥º, Ï†ÄÏû•ÏùÑ Í±¥ÎÑàÎúÅÎãàÎã§.', e);
                }
                
            } catch (error) {
                console.error('ÌîÑÎ°úÏ†ùÌä∏ Î°úÎìú Ïã§Ìå®:', error);
                projectList.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #dc3545;">ÌîÑÎ°úÏ†ùÌä∏ Î°úÎìúÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.</td></tr>';
                showAlert('Failed to load project list.', 'error');
            } finally {
                loader.classList.add('hidden');
            }
        }

        // ÌîÑÎ°úÏ†ùÌä∏ ÏÇ≠Ï†ú - Firebase Î≤ÑÏ†Ñ
        async function deleteProject(projectName, projectId) {
            if (!isFirebaseReady) {
                showAlert('Please check Firebase connection.', 'error');
                return;
            }

            if (confirm(`Are you sure you want to delete the project "${projectName}"?`)) {
                try {
                    await deleteProjectFromFirestore(projectId);
                    showAlert('Project has been deleted!');
                    
                    // ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
                    await loadProjects();
                    
                } catch (error) {
                    console.error('ÌîÑÎ°úÏ†ùÌä∏ ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                    showAlert('Failed to delete project: ' + error.message, 'error');
                }
            }
        }

        // Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÎäî ÌîÑÎ°úÏ†ùÌä∏Îì§ ÏùºÍ¥Ñ ÏÇ≠Ï†ú
        async function deleteProjectsWithoutImages() {
            if (!isFirebaseReady) {
                showAlert('Please check Firebase connection.', 'error');
                return;
            }

            try {
                // ÌòÑÏû¨ ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ù Í∞ÄÏ†∏Ïò§Í∏∞
                const projects = await getProjects();
                const projectsArray = Object.values(projects);
                
                // Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÎäî ÌîÑÎ°úÏ†ùÌä∏Îì§ ÌïÑÌÑ∞ÎßÅ
                const projectsWithoutImages = projectsArray.filter(project => {
                    const hasMainImage = project.mainImage && project.mainImage.trim() !== '';
                    const hasImages = project.images && project.images.length > 0;
                    const hasAdditionalImages = project.additionalImages && project.additionalImages.length > 0;
                    
                    return !hasMainImage && !hasImages && !hasAdditionalImages;
                });

                if (projectsWithoutImages.length === 0) {
                    showAlert('Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÎäî ÌîÑÎ°úÏ†ùÌä∏Í∞Ä ÏóÜÏäµÎãàÎã§.', 'info');
                    return;
                }

                // ÏÇ≠Ï†úÌï† ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ù ÌëúÏãú
                const projectNames = projectsWithoutImages.map(p => p.name).join('\n');
                const confirmMessage = `Îã§Ïùå ${projectsWithoutImages.length}Í∞ú ÌîÑÎ°úÏ†ùÌä∏Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\n${projectNames}\n\n(Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏûàÎäî ÌîÑÎ°úÏ†ùÌä∏Îäî Ï†úÏô∏Îê©ÎãàÎã§)`;
                
                if (confirm(confirmMessage)) {
                    let deletedCount = 0;
                    let failedCount = 0;
                    
                    for (const project of projectsWithoutImages) {
                        try {
                            await deleteProjectFromFirestore(project.id);
                            deletedCount++;
                            console.log(`ÌîÑÎ°úÏ†ùÌä∏ ÏÇ≠Ï†ú ÏÑ±Í≥µ: ${project.name}`);
                        } catch (error) {
                            failedCount++;
                            console.error(`ÌîÑÎ°úÏ†ùÌä∏ ÏÇ≠Ï†ú Ïã§Ìå®: ${project.name}`, error);
                        }
                    }
                    
                    // Í≤∞Í≥º ÌëúÏãú
                    const resultMessage = `ÏÇ≠Ï†ú ÏôÑÎ£å!\n\nÏÑ±Í≥µ: ${deletedCount}Í∞ú\nÏã§Ìå®: ${failedCount}Í∞ú`;
                    showAlert(resultMessage, 'success');
                    
                    // ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
                    await loadProjects();
                }
                
            } catch (error) {
                console.error('ÏùºÍ¥Ñ ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                showAlert('ÏùºÍ¥Ñ ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message, 'error');
            }
        }

        // ÌäπÏ†ï ÌîÑÎ°úÏ†ùÌä∏ Ïù¥Î¶ÑÏúºÎ°ú ÏÇ≠Ï†ú
        async function deleteProjectByName(projectName) {
            if (!isFirebaseReady) {
                showAlert('Please check Firebase connection.', 'error');
                return;
            }

            try {
                // ÌòÑÏû¨ ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ù Í∞ÄÏ†∏Ïò§Í∏∞
                const projects = await getProjects();
                const project = projects[projectName];
                
                if (!project) {
                    showAlert(`ÌîÑÎ°úÏ†ùÌä∏ "${projectName}"ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.`, 'error');
                    return;
                }

                if (confirm(`ÌîÑÎ°úÏ†ùÌä∏ "${projectName}"ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                    await deleteProjectFromFirestore(project.id);
                    showAlert(`ÌîÑÎ°úÏ†ùÌä∏ "${projectName}"Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.`, 'success');
                    
                    // ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
                    await loadProjects();
                }
                
            } catch (error) {
                console.error('ÌîÑÎ°úÏ†ùÌä∏ ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                showAlert('ÌîÑÎ°úÏ†ùÌä∏ ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message, 'error');
            }
        }

        // Zavelsteinstr.ÏôÄ Albanistr. ÌîÑÎ°úÏ†ùÌä∏ Í∞ïÏ†ú ÏÇ≠Ï†ú
        async function deleteSpecificProjects() {
            if (!isFirebaseReady) {
                showAlert('Please check Firebase connection.', 'error');
                return;
            }

            const projectsToDelete = ['Zavelsteinstr.', 'Albanistr.'];
            
            if (confirm(`Îã§Ïùå ÌîÑÎ°úÏ†ùÌä∏Îì§ÏùÑ Í∞ïÏ†úÎ°ú ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\n${projectsToDelete.join('\n')}\n\n(Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏûàÏñ¥ÎèÑ ÏÇ≠Ï†úÎê©ÎãàÎã§)`)) {
                try {
                    let deletedCount = 0;
                    let failedCount = 0;
                    
                    for (const projectName of projectsToDelete) {
                        try {
                            const projects = await getProjects();
                            const project = projects[projectName];
                            
                            if (project) {
                                await deleteProjectFromFirestore(project.id);
                                deletedCount++;
                                console.log(`ÌîÑÎ°úÏ†ùÌä∏ ÏÇ≠Ï†ú ÏÑ±Í≥µ: ${projectName}`);
                            } else {
                                console.log(`ÌîÑÎ°úÏ†ùÌä∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÏùå: ${projectName}`);
                            }
                        } catch (error) {
                            failedCount++;
                            console.error(`ÌîÑÎ°úÏ†ùÌä∏ ÏÇ≠Ï†ú Ïã§Ìå®: ${projectName}`, error);
                        }
                    }
                    
                    // Í≤∞Í≥º ÌëúÏãú
                    const resultMessage = `ÏÇ≠Ï†ú ÏôÑÎ£å!\n\nÏÑ±Í≥µ: ${deletedCount}Í∞ú\nÏã§Ìå®: ${failedCount}Í∞ú`;
                    showAlert(resultMessage, 'success');
                    
                    // ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
                    await loadProjects();
                    
                } catch (error) {
                    console.error('ÌäπÏ†ï ÌîÑÎ°úÏ†ùÌä∏ ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                    showAlert('ÌîÑÎ°úÏ†ùÌä∏ ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message, 'error');
                }
            }
        }

        // ÌååÏùº ÏÑ†ÌÉù Ïãú ÌååÏùºÎ™Ö ÌëúÏãú
        document.getElementById('projectImage').addEventListener('change', function() {
            const file = this.files[0];
            const fileNameSpan = document.getElementById('projectImageName');
            if (file) {
                fileNameSpan.textContent = file.name;
            } else {
                fileNameSpan.textContent = 'No file selected';
            }
        });

        // Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞
        document.getElementById('projectImage').addEventListener('change', async function() {
            const file = this.files[0];
            const previewContainer = document.getElementById('mainImagePreview');
            
            if (file) {
                try {
                    // Firebase StorageÏóê ÏóÖÎ°úÎìú
                    const downloadURL = await uploadImageToStorage(file, 'main-images');
                    
                    const img = document.createElement('img');
                    img.src = downloadURL;
                    img.alt = 'Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞';
                    previewContainer.innerHTML = '';
                    previewContainer.appendChild(img);
                    
                    // Storage URLÏùÑ ÏûÑÏãú Ï†ÄÏû• (Ìèº Ï†úÏ∂ú Ïãú ÏÇ¨Ïö©)
                    previewContainer.dataset.storageUrl = downloadURL;
                    
                    console.log('Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ ÏõêÎ≥∏ ÏóÖÎ°úÎìú ÏôÑÎ£å:', downloadURL);
                } catch (error) {
                    console.error('Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ Ï≤òÎ¶¨ Ïã§Ìå®:', error);
                    alert('Error occurred while processing main image.');
                }
            } else {
                previewContainer.innerHTML = '';
                delete previewContainer.dataset.storageUrl;
            }
        });

        function renderAdditionalPreview() {
            const container = document.getElementById('additionalPreviewContainer');
            
            if (additionalImages.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; margin: 10px 0;">No additional images.</p>';
                return;
            }
            
            container.innerHTML = additionalImages.map((img, index) => `
                <div class="additional-preview-item" data-id="${img.id}">
                    <img src="${img.url}" alt="Ï∂îÍ∞Ä Ïù¥ÎØ∏ÏßÄ ${index + 1}" class="additional-preview-img">
                    <div class="slide-preview-controls">
                        <button type="button" class="slide-control-btn delete-slide-btn" onclick="removeAdditionalImage('${img.id}')">√ó</button>
                    </div>
                </div>
            `).join('');
        }

        function removeAdditionalImage(imageId) {
            additionalImages = additionalImages.filter(img => img.id !== imageId);
            renderAdditionalPreview();
        }

        // ÌåÄ Î©§Î≤Ñ Î™©Î°ù Î°úÎìú
        async function loadMembers() {
            const membersList = document.getElementById('membersList');
            const loader = document.getElementById('membersLoader');
            
            try {
                loader.classList.remove('hidden');
                membersList.innerHTML = '';

                if (!isFirebaseReady) {
                    membersList.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #999;">Please check Firebase connection.</td></tr>';
                    return;
                }

                const { collection, getDocs, query, orderBy } = window.firestoreFunctions;
                
                // orderBy ÏóÜÏù¥ Î®ºÏ†Ä ÏãúÎèÑ
                let q;
                try {
                    q = query(collection(window.db, 'team'), orderBy('createdAt', 'desc'));
                } catch (error) {
                    q = query(collection(window.db, 'team'));
                }
                
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    membersList.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #999;">Îì±Î°ùÎêú Î©§Î≤ÑÍ∞Ä ÏóÜÏäµÎãàÎã§.</td></tr>';
                } else {
                    querySnapshot.forEach((doc) => {
                        const member = doc.data();
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${member.name || 'No Name'}</td>
                            <td>${member.position || 'No Position'}</td>
                            <td>${member.email || 'No Email'}</td>
                            <td>
                                ${member.image && !member.image.startsWith('data:') ? `<img src="${member.image}" alt="${member.name}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">` : 'No Image'}
                            </td>
                            <td>
                                <button class="btn-edit" onclick="handleEditMember(this, '${doc.id}')">Edit</button>
                                <button class="btn-danger" onclick="deleteMember('${doc.id}', '${member.name}')">Delete</button>
                            </td>
                        `;
                        membersList.appendChild(row);
                    });
                }
                
            } catch (error) {
                console.error('Î©§Î≤Ñ Î°úÎìú Ïã§Ìå®:', error);
                membersList.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #dc3545;">Î©§Î≤Ñ Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.</td></tr>';
            } finally {
                loader.classList.add('hidden');
            }
        }

        // Î©§Î≤Ñ ÏàòÏ†ï Ï≤òÎ¶¨
        async function handleEditMember(button, memberId) {
            try {
                const { doc, getDoc } = window.firestoreFunctions;
                const memberDoc = await getDoc(doc(window.db, 'team', memberId));
                
                if (memberDoc.exists()) {
                    const member = memberDoc.data();
                    
                    // ÌèºÏóê Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ Ï±ÑÏö∞Í∏∞
                    document.getElementById('memberName').value = member.name || '';
                    document.getElementById('memberPosition').value = member.position || '';
                    document.getElementById('memberEmail').value = member.email || '';
                    
                    // ÏàòÏ†ï Î™®Îìú ÌëúÏãú
                    const submitBtn = document.querySelector('#memberAddForm button[type="submit"]');
                    submitBtn.textContent = 'Modify Member';
                    
                    // ÏàòÏ†ï ÏôÑÎ£å ÌõÑ Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®ÏùÑ ÏúÑÌï¥ Î©§Î≤Ñ ID Ï†ÄÏû•
                    submitBtn.dataset.editingMemberId = memberId;
                    
                    // ÌèºÏúºÎ°ú Ïä§ÌÅ¨Î°§
                    document.querySelector('#memberAddForm').scrollIntoView({ behavior: 'smooth' });
                }
            } catch (error) {
                console.error('Î©§Î≤Ñ ÏàòÏ†ï Î°úÎìú Ïã§Ìå®:', error);
                alert('Failed to load member information.');
            }
        }



        // Î©§Î≤Ñ ÏÇ≠Ï†ú
        async function deleteMember(memberId, memberName) {
            if (confirm(`Are you sure you want to delete the member "${memberName}"?`)) {
                try {
                    const { doc, deleteDoc } = window.firestoreFunctions;
                    await deleteDoc(doc(window.db, 'team', memberId));
                    alert('Member has been deleted!');
                    await loadMembers(); // Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
                } catch (error) {
                    console.error('Î©§Î≤Ñ ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                    alert('Failed to delete member: ' + error.message);
                }
            }
        }

        // Î©§Î≤Ñ Ïù¥ÎØ∏ÏßÄ ÌååÏùºÎ™Ö ÌëúÏãú
        document.getElementById('memberImage').addEventListener('change', function() {
            const file = this.files[0];
            const fileNameSpan = document.getElementById('memberImageName');
            if (file) {
                fileNameSpan.textContent = file.name;
            } else {
                fileNameSpan.textContent = 'No file selected';
            }
        });

        // Î©§Î≤Ñ Ïù¥ÎØ∏ÏßÄ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ìï®Ïàò
        async function migrateMemberImagesToStorage() {
            if (!isFirebaseReady) {
                showAlert('Firebase Ïó∞Í≤∞ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }

            try {
                console.log('=== Î©§Î≤Ñ Ïù¥ÎØ∏ÏßÄ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÏãúÏûë ===');
                
                const { collection, getDocs, updateDoc, doc } = window.firestoreFunctions;
                const querySnapshot = await getDocs(collection(window.db, 'team'));
                
                if (querySnapshot.empty) {
                    showAlert('ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖòÌï† Î©§Î≤ÑÍ∞Ä ÏóÜÏäµÎãàÎã§.', 'info');
                    return;
                }

                console.log(`Ï¥ù ${querySnapshot.size}Í∞ú Î©§Î≤Ñ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÏãúÏûë`);
                
                let migratedCount = 0;
                let skippedCount = 0;
                let errorCount = 0;

                for (const memberDoc of querySnapshot.docs) {
                    try {
                        const member = memberDoc.data();
                        console.log(`ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ï§ë: ${member.name}`);
                        
                        if (member.image && member.image.startsWith('data:')) {
                            console.log(`- Î©§Î≤Ñ Ïù¥ÎØ∏ÏßÄ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò: ${member.name}`);
                            try {
                                const imageBlob = await dataURLToBlob(member.image);
                                const file = new File([imageBlob], `${member.name}_profile.jpg`, { type: 'image/jpeg' });
                                const storageURL = await uploadImageToStorage(file, 'team-images');
                                
                                await updateDoc(doc(window.db, 'team', memberDoc.id), {
                                    image: storageURL,
                                    updatedAt: new Date().toISOString()
                                });
                                
                                migratedCount++;
                                console.log(`- Î©§Î≤Ñ Ïù¥ÎØ∏ÏßÄ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÏôÑÎ£å: ${storageURL}`);
                            } catch (error) {
                                console.error(`- Î©§Î≤Ñ Ïù¥ÎØ∏ÏßÄ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ïã§Ìå®: ${error.message}`);
                                errorCount++;
                                continue;
                            }
                        } else {
                            skippedCount++;
                            console.log(`‚è≠Ô∏è ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Î∂àÌïÑÏöî: ${member.name} (Ïù¥ÎØ∏ Storage URL ÏÇ¨Ïö© Ï§ë)`);
                        }

                    } catch (error) {
                        console.error(`‚ùå Î©§Î≤Ñ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ïã§Ìå®: ${member.name}`, error);
                        errorCount++;
                    }
                }

                console.log('=== Î©§Î≤Ñ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÏôÑÎ£å ===');
                console.log(`ÏÑ±Í≥µ: ${migratedCount}Í∞ú`);
                console.log(`Í±¥ÎÑàÎúÄ: ${skippedCount}Í∞ú`);
                console.log(`Ïã§Ìå®: ${errorCount}Í∞ú`);

                showAlert(`Î©§Î≤Ñ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÏôÑÎ£å!\nÏÑ±Í≥µ: ${migratedCount}Í∞ú\nÍ±¥ÎÑàÎúÄ: ${skippedCount}Í∞ú\nÏã§Ìå®: ${errorCount}Í∞ú`, 'success');

                await loadMembers();

            } catch (error) {
                console.error('Î©§Î≤Ñ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ïã§Ìå®:', error);
                showAlert('Î©§Î≤Ñ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message, 'error');
            }
        }

        // Î©§Î≤Ñ Ï∂îÍ∞Ä/ÏàòÏ†ï Ìèº Firestore Ï†ÄÏû•
        document.getElementById('memberAddForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const name = document.getElementById('memberName').value.trim();
            const position = document.getElementById('memberPosition').value.trim();
            const email = document.getElementById('memberEmail').value.trim();
            const imageFile = document.getElementById('memberImage').files[0];
            
            if (!name || !position || !email) {
                alert('Please fill in all fields.');
                return;
            }

            try {
                let imageUrl = '';
                
                if (imageFile) {
                    // ÏÉà Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏÑ†ÌÉùÎêú Í≤ΩÏö∞ - Firebase Storage
                    imageUrl = await uploadImageToStorage(imageFile, 'team-images');
                }

                const submitBtn = this.querySelector('button[type="submit"]');
                const editingMemberId = submitBtn.dataset.editingMemberId;

                if (editingMemberId) {
                    // ÏàòÏ†ï Î™®Îìú
                    const { doc, updateDoc } = window.firestoreFunctions;
                    const updateData = {
                        name, position, email,
                        updatedAt: new Date().toISOString()
                    };
                    
                    if (imageUrl) {
                        updateData.image = imageUrl;
                    }
                    
                    await updateDoc(doc(window.db, 'team', editingMemberId), updateData);
                    alert('Member has been successfully modified!');
                    
                    // ÏàòÏ†ï Î™®Îìú Ìï¥Ï†ú
                    delete submitBtn.dataset.editingMemberId;
                    submitBtn.textContent = 'Add Member';
                } else {
                    // ÏÉà Î©§Î≤Ñ Ï∂îÍ∞Ä
                    if (!imageFile) {
                        alert('Please select an image.');
                        return;
                    }
                    
                    const { collection, addDoc } = window.firestoreFunctions;
                    await addDoc(collection(window.db, 'team'), {
                        name, position, email, image: imageUrl, createdAt: new Date().toISOString()
                    });
                    alert('Member has been successfully added!');
                }
                
                this.reset();
                await loadMembers(); // Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
                
            } catch (err) {
                alert('Failed to save member: ' + err.message);
            }
        });

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Firebase ÏÉÅÌÉú Ï≤¥ÌÅ¨
        window.addEventListener('load', function() {
            console.log('ÌéòÏù¥ÏßÄ Î°úÎìúÎê® - Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú:', isLoggedIn);
            console.log('Firebase Ï¥àÍ∏∞ ÏÉÅÌÉú:', isFirebaseReady);
            console.log('window.db:', window.db);
            console.log('window.firestoreFunctions:', window.firestoreFunctions);
            
            if (isLoggedIn) {
                console.log('Î°úÍ∑∏Ïù∏Îêú ÏÉÅÌÉúÏóêÏÑú Firebase Ï§ÄÎπÑ ÌôïÏù∏ ÏãúÏûë');
                checkFirebaseReady().then((ready) => {
                    console.log('Firebase Ï§ÄÎπÑ ÌôïÏù∏ Í≤∞Í≥º:', ready);
                    if (ready) {
                        loadProjects();
                        loadMembers(); // ÌåÄ Î©§Î≤Ñ Î™©Î°ùÎèÑ Ìï®Íªò Î°úÎìú
                    }
                });
            }
        });

        // Firebase Ïó∞Í≤∞ ÏÉÅÌÉú ÌôïÏù∏ ÌõÑ Î©§Î≤Ñ Î°úÎìú Ïû¨ÏãúÎèÑ
        setTimeout(() => {
            console.log('2Ï¥à ÌõÑ Firebase ÏÉÅÌÉú Ïû¨ÌôïÏù∏:', isFirebaseReady);
            if (isFirebaseReady && isLoggedIn) {
                console.log('2Ï¥à ÌõÑ Î©§Î≤Ñ Î°úÎìú Ïû¨ÏãúÎèÑ');
                loadMembers();
            }
        }, 2000);

        // Ï∂îÍ∞Ä ÏïàÏ†ÑÏû•Ïπò: 5Ï¥à ÌõÑÏóêÎèÑ Î°úÎìúÎêòÏßÄ ÏïäÏúºÎ©¥ Ïû¨ÏãúÎèÑ
        setTimeout(() => {
            console.log('5Ï¥à ÌõÑ Firebase ÏÉÅÌÉú Ïû¨ÌôïÏù∏:', isFirebaseReady);
            if (isFirebaseReady && isLoggedIn) {
                console.log('5Ï¥à ÌõÑ Î©§Î≤Ñ Î°úÎìú Ïû¨ÏãúÎèÑ');
                loadMembers();
            }
        }, 5000);

        // Firebase Ïó∞Í≤∞ ÏÉÅÌÉú ÌôïÏù∏ (ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú)
        setTimeout(() => {
            console.log('5Ï¥à ÌõÑ Firebase Ïó∞Í≤∞ ÏÉÅÌÉú ÏµúÏ¢Ö ÌôïÏù∏:', isFirebaseReady);
            if (!isFirebaseReady) {
                console.log('Firebase Ïó∞Í≤∞ Ïã§Ìå® - ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏');
                updateFirebaseStatus(false, 'Firebase ÏÑ§Ï†ïÍ∞íÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî');
            }
        }, 5000);



        // Ïù¥ÎØ∏ÏßÄ ÌíàÏßà Í≤ÄÏÇ¨ Ìï®Ïàò
        function checkImageQuality(file) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = function() {
                    const width = this.width;
                    const height = this.height;
                    const isLowQuality = width < 1920 || height < 1080;
                    
                    resolve({
                        width: width,
                        height: height,
                        isLowQuality: isLowQuality,
                        aspectRatio: (width / height).toFixed(2)
                    });
                };
                img.onerror = function() {
                    resolve({
                        width: 0,
                        height: 0,
                        isLowQuality: true,
                        aspectRatio: 0
                    });
                };
                img.src = URL.createObjectURL(file);
            });
        }

        // base64 Îç∞Ïù¥ÌÑ∞Î•º BlobÏúºÎ°ú Î≥ÄÌôòÌïòÎäî Ìï®Ïàò
        function dataURLToBlob(dataURL) {
            return new Promise((resolve, reject) => {
                try {
                    const arr = dataURL.split(',');
                    const mime = arr[0].match(/:(.*?);/)[1];
                    const bstr = atob(arr[1]);
                    let n = bstr.length;
                    const u8arr = new Uint8Array(n);
                    
                    while (n--) {
                        u8arr[n] = bstr.charCodeAt(n);
                    }
                    
                    const blob = new Blob([u8arr], { type: mime });
                    resolve(blob);
                } catch (error) {
                    reject(error);
                }
            });
        }

        // ÌåÄ Î©§Î≤Ñ Ïù¥ÎØ∏ÏßÄ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ìï®Ïàò Í∏∞Ï°¥ ÏúÑÏπò ÏïÑÎûòÏóê ÌîÑÎ°úÏ†ùÌä∏ Ïù¥ÎØ∏ÏßÄ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ï∂îÍ∞Ä
        async function migrateProjectImagesToStorage() {
            if (!isFirebaseReady) {
                showAlert('Please check Firebase connection.', 'error');
                return;
            }

            try {
                const { collection, getDocs, doc, updateDoc } = window.firestoreFunctions;
                showAlert('Project image migration started...', 'success');

                const querySnapshot = await getDocs(collection(window.db, 'projects'));
                let migratedCount = 0;
                let skippedCount = 0;
                let errorCount = 0;

                for (const projectDoc of querySnapshot.docs) {
                    try {
                        const project = projectDoc.data();
                        const updates = {};
                        let changed = false;

                        // Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ Ï≤òÎ¶¨ (base64 ‚Üí Storage URL)
                        if (project.mainImage && typeof project.mainImage === 'string' && project.mainImage.startsWith('data:')) {
                            try {
                                const imageBlob = await dataURLToBlob(project.mainImage);
                                const file = new File([imageBlob], `${project.name || 'project'}_main.jpg`, { type: 'image/jpeg' });
                                const storageURL = await uploadImageToStorage(file, 'main-images');
                                updates.mainImage = storageURL;
                                changed = true;
                            } catch (e) {
                                console.error('Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ïã§Ìå®:', project.name, e);
                                errorCount++;
                            }
                        }

                        // Ï∂îÍ∞Ä Ïù¥ÎØ∏ÏßÄ Ï≤òÎ¶¨
                        if (Array.isArray(project.additionalImages) && project.additionalImages.length > 0) {
                            const newAdditional = [];
                            for (let i = 0; i < project.additionalImages.length; i++) {
                                const url = project.additionalImages[i];
                                if (typeof url === 'string' && url.startsWith('data:')) {
                                    try {
                                        const imageBlob = await dataURLToBlob(url);
                                        const file = new File([imageBlob], `${project.name || 'project'}_additional_${i + 1}.jpg`, { type: 'image/jpeg' });
                                        const storageURL = await uploadImageToStorage(file, 'additional-images');
                                        newAdditional.push(storageURL);
                                        changed = true;
                                    } catch (e) {
                                        console.error('Ï∂îÍ∞Ä Ïù¥ÎØ∏ÏßÄ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ïã§Ìå®:', project.name, i, e);
                                        errorCount++;
                                    }
                                } else if (typeof url === 'string' && url.trim() !== '') {
                                    newAdditional.push(url);
                                }
                            }
                            if (changed) {
                                updates.additionalImages = newAdditional;
                            }
                        }

                        // Í∏∞ÌÉÄ images Î∞∞Ïó¥ Ï≤òÎ¶¨ (ÏÇ¨Ïö© Ï§ëÏùº Ïàò ÏûàÏùå)
                        if (Array.isArray(project.images) && project.images.length > 0) {
                            const newImages = [];
                            for (let i = 0; i < project.images.length; i++) {
                                const url = project.images[i];
                                if (typeof url === 'string' && url.startsWith('data:')) {
                                    try {
                                        const imageBlob = await dataURLToBlob(url);
                                        const file = new File([imageBlob], `${project.name || 'project'}_image_${i + 1}.jpg`, { type: 'image/jpeg' });
                                        const storageURL = await uploadImageToStorage(file, 'images');
                                        newImages.push(storageURL);
                                        changed = true;
                                    } catch (e) {
                                        console.error('images Î∞∞Ïó¥ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ïã§Ìå®:', project.name, i, e);
                                        errorCount++;
                                    }
                                } else if (typeof url === 'string' && url.trim() !== '') {
                                    newImages.push(url);
                                }
                            }
                            if (changed) {
                                updates.images = newImages;
                            }
                        }

                        if (changed) {
                            updates.updatedAt = new Date().toISOString();
                            await updateDoc(doc(window.db, 'projects', projectDoc.id), updates);
                            migratedCount++;
                            console.log('ÌîÑÎ°úÏ†ùÌä∏ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÏôÑÎ£å:', project.name || projectDoc.id);
                        } else {
                            skippedCount++;
                            console.log('ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Î∂àÌïÑÏöî:', project.name || projectDoc.id);
                        }
                    } catch (err) {
                        console.error('ÌîÑÎ°úÏ†ùÌä∏ Ï≤òÎ¶¨ Ïã§Ìå®:', projectDoc.id, err);
                        errorCount++;
                    }
                }

                showAlert(`Project migration done. Migrated: ${migratedCount}, Skipped: ${skippedCount}, Failed: ${errorCount}`, 'success');
                // Î™©Î°ù Í∞±Ïã†
                await loadProjects();
            } catch (error) {
                console.error('ÌîÑÎ°úÏ†ùÌä∏ Ïù¥ÎØ∏ÏßÄ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ïã§Ìå®:', error);
                showAlert('Project image migration failed: ' + error.message, 'error');
            }
        }
    </script>
</body>
</html> 
</html> 
</html> 
</html> 