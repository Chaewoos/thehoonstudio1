<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">SEOL & KONG SISTERS
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>메인 페이지</title>
    <link rel="stylesheet" href="style.css">
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        const firebaseConfig = {
            apiKey: "AIzaSyDUJrHXzQfZ2-FwaZcuMcLu-71gRTVO2b4",
            authDomain: "the-hoon-studio.firebaseapp.com",
            projectId: "the-hoon-studio",
            storageBucket: "the-hoon-studio.firebasestorage.app",
            messagingSenderId: "857575526697",
            appId: "1:857575526697:web:43d66881a72f96e5a6e738"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.loadMainSlides = async function() {
            try {
                const slidesContainer = document.querySelector('.slides');
                const mainBottomText = document.querySelector('.main-bottom-text');
                
                // 기존 슬라이드 제거
                slidesContainer.innerHTML = '';
                mainBottomText.textContent = '';
                
                console.log('Firebase에서 프로젝트 로드 시작...');
                
                // Firestore에서 모든 프로젝트 불러오기
                const q = query(collection(db, 'projects'));
                const querySnapshot = await getDocs(q);
                const projects = [];
                
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    console.log('프로젝트 데이터:', data.name, data.mainImage ? '이미지 있음' : '이미지 없음');
                    projects.push({
                        name: data.name,
                        image: data.mainImage || '',
                        color: data.mainImage && data.mainImage.startsWith('data:') ? 'white' : 'black'
                    });
                });
                
                console.log('로드된 프로젝트 수:', projects.length);
                
                if (projects.length === 0) {
                    console.log('프로젝트가 없습니다. 기본 이미지 사용');
                                    // 기본 이미지들 사용 (고화질)
                const defaultImages = [
                    { image: './image/240312_fch_perspektive1.jpg', color: 'white' },
                    { image: './image/241022_ms_vgb_v2.jpg', color: 'white' },
                    { image: './image/250522_km22_wz2.jpg', color: 'white' },
                    { image: './image/hochauflosend.jpg', color: 'black' }
                ];
                    
                    defaultImages.forEach((item, i) => {
                        const div = document.createElement('div');
                        div.className = 'slide';
                        div.style.backgroundImage = `url('${item.image}')`;
                        div.style.color = item.color;
                        slidesContainer.appendChild(div);
                    });
                    
                    window._mainSlideNames = ['MAI STR.', 'PROJECT 2', 'PROJECT 3', 'PROJECT 4'];
                } else {
                    // Firebase에서 가져온 프로젝트들로 슬라이드 생성
                    projects.forEach((p, i) => {
                        const div = document.createElement('div');
                        div.className = 'slide';
                        div.style.backgroundImage = `url('${p.image}')`;
                        div.style.color = p.color;
                        // 클릭 시 해당 프로젝트 상세로 이동
                        if (p.name) {
                            div.style.cursor = 'pointer';
                            div.addEventListener('click', () => {
                                window.location.href = `./projects.html?project=${encodeURIComponent(p.name)}`;
                            });
                        }
                        slidesContainer.appendChild(div);
                    });
                    
                    // 슬라이드 텍스트 배열
                    window._mainSlideNames = projects.map(p => p.name);
                }
                
                // 슬라이드 동작 초기화
                if (window.initMainSlider) {
                    window.initMainSlider();
                }
                
                console.log('Firebase 프로젝트 로드 완료');
                
            } catch (error) {
                console.error('Firebase 프로젝트 로드 실패:', error);
                // 에러 시 기본 이미지 사용
                const slidesContainer = document.querySelector('.slides');
                const mainBottomText = document.querySelector('.main-bottom-text');
                
                slidesContainer.innerHTML = `
                    <div class="slide" style="background-image: url('./image/240312_fch_perspektive1.jpg'); color: white;"></div>
                    <div class="slide" style="background-image: url('./image/241022_ms_vgb_v2.jpg'); color: white;"></div>
                    <div class="slide" style="background-image: url('./image/250522_km22_wz2.jpg'); color: white;"></div>
                    <div class="slide" style="background-image: url('./image/hochauflosend.jpg'); color: black;"></div>
                `;
                
                window._mainSlideNames = ['MAI STR.', 'PROJECT 2', 'PROJECT 3', 'PROJECT 4'];
                
                if (window.initMainSlider) {
                    window.initMainSlider();
                }
            }
        }
    </script>
</head>
<body class="index-page" style="overflow: hidden;">
    <!-- 로고 애니메이션 오버레이 -->
    <div id="logoAnimation" class="logo-animation">
        <div class="logo-animation-container">
            <img src="./image/logo/Logo.png" alt="로고" class="logo-animation-image">
            <div class="logo-animation-text">THE HOON STUDIO</div>
        </div>
    </div>

    <div class="overlay" onclick="toggleMenu()"></div>

    <div class="header">
        <a href="./index.html" class="logo-link" id="mainLogo">
            <img src="./image/logo/Logo.png" alt="로고" class="logo">
        </a>
        <div class="navbar-toggle" onclick="toggleMenu()" role="button" tabindex="0" id="menuBurger">
            <div class="burger-icon-container">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </div>
        </div>
    </div>
    <!-- 기존 위치의 #menuLogoIcon 제거 -->

    <div class="slider">
      <div class="slides">
        <!-- Firebase에서 동적으로 로드됩니다 -->
      </div>
    </div>

    <div class="main-bottom-text" id="mainBottomText">MAI STR.</div>

    <script>
    // 로고 애니메이션 실행
    document.addEventListener('DOMContentLoaded', function() {
        const logoAnimation = document.getElementById('logoAnimation');
        const logoImage = document.querySelector('.logo-animation-image');
        const logoText = document.querySelector('.logo-animation-text');
        
        // 초기 상태 설정 - 확실히 숨김
        if (logoImage) logoImage.style.opacity = '0';
        if (logoText) logoText.style.opacity = '0';
        
        // 페이지 로드 후 약간의 지연을 두고 애니메이션 시작
        setTimeout(() => {
            // 로고 이미지 나타남
            if (logoImage) logoImage.style.opacity = '1';
            
            // 로고 이미지 사라짐 (1.5초 후)
            setTimeout(() => {
                if (logoImage) logoImage.style.opacity = '0';
            }, 1500);
            
            // 텍스트 나타남 (2초 후)
            setTimeout(() => {
                if (logoText) logoText.style.opacity = '1';
            }, 2000);
            
            // 텍스트 사라짐 (3.5초 후)
            setTimeout(() => {
                if (logoText) logoText.style.opacity = '0';
            }, 3500);
            
            // 애니메이션 완료 후 오버레이 제거 (4초 후)
            setTimeout(() => {
                if (logoAnimation) {
                    logoAnimation.style.opacity = '0';
                    setTimeout(() => {
                        if (logoAnimation) logoAnimation.style.display = 'none';
                    }, 500);
                }
            }, 4000);
        }, 100);
    });

    // Firestore에서 슬라이드 불러온 후 동작
    window.initMainSlider = function() {
        const slidesContainer = document.querySelector('.slides');
        const slides = Array.from(slidesContainer.children);
        const totalSlides = slides.length;
        const mainBottomText = document.getElementById('mainBottomText');
        const projectNames = window._mainSlideNames || [];

        console.log('mainBottomText found:', mainBottomText); // 디버깅

        // 각 슬라이드별 위치 설정 (margin-right 값)
        const margins = [
            '0px',     // 첫 번째: 오른쪽에 붙음
            'calc(100vw - 160px)'   // 두 번째: 왼쪽 끝 (화면 너비에서 160px 뺀 위치, 오른쪽과 동일한 여백)
        ];

        // 각 슬라이드별 선 길이 설정 (동적으로 계산)
        const lineWidths = [
            'calc(100vw + 500px)',  // 첫 번째: 오른쪽에서 화면 밖까지
            'auto'   // 두 번째: 동적으로 계산
        ];

        // 앞뒤로 클론 추가
        const firstClone = slides[0].cloneNode(true);
        const lastClone = slides[totalSlides - 1].cloneNode(true);
        slidesContainer.appendChild(firstClone);
        slidesContainer.insertBefore(lastClone, slidesContainer.firstChild);

        let currentIndex = 1; // 클론 때문에 1부터 시작
        let isTransitioning = false;

        // 슬라이드 컨테이너 너비 조정
        slidesContainer.style.width = `${(totalSlides + 2) * 100}vw`;
        slidesContainer.style.transition = 'none';
        slidesContainer.style.transform = `translateX(-${currentIndex * 100}vw)`;

        // 초기 텍스트 설정
        updateProjectName(currentIndex - 1);
        
        // 초기 상태에서 left-version 클래스 제거 (오른쪽 배치로 시작)
        mainBottomText.classList.remove('left-version');

        setTimeout(() => {
            slidesContainer.style.transition = 'transform 0.5s ease';
        }, 20);

        function updateProjectName(slideIndex) {
            const actualIndex = slideIndex % totalSlides;
            
            if (projectNames[actualIndex]) {
                mainBottomText.textContent = projectNames[actualIndex].toUpperCase();
            }
            
            // JAKOB-KLAR-STR. 프로젝트는 항상 왼쪽에 배치
            const currentProjectName = projectNames[actualIndex];
            if (currentProjectName && currentProjectName.toUpperCase().includes('JAKOB-KLAR-STR')) {
                // 왼쪽 배치 - 새로운 스타일
                mainBottomText.classList.add('left-version');
                mainBottomText.style.left = '80px';
                mainBottomText.style.right = 'auto';
                mainBottomText.style.textAlign = 'left';
                console.log('JAKOB-KLAR-STR 강제 왼쪽 배치:', actualIndex, '텍스트:', projectNames[actualIndex]);
            } else {
                // 슬라이드 인덱스에 따라 번갈아가며 오른쪽/왼쪽 배치
                if (actualIndex % 2 === 0) { // 짝수 슬라이드 (0, 2, 4...)
                    // 오른쪽 배치 - 기존 스타일
                    mainBottomText.classList.remove('left-version');
                    mainBottomText.style.right = '80px';
                    mainBottomText.style.left = 'auto';
                    mainBottomText.style.textAlign = 'right';
                    console.log('오른쪽 배치:', actualIndex, '텍스트:', projectNames[actualIndex]);
                } else { // 홀수 슬라이드 (1, 3, 5...)
                    // 왼쪽 배치 - 새로운 스타일
                    mainBottomText.classList.add('left-version');
                    mainBottomText.style.left = '80px';
                    mainBottomText.style.right = 'auto';
                    mainBottomText.style.textAlign = 'left';
                    console.log('왼쪽 배치:', actualIndex, '텍스트:', projectNames[actualIndex]);
                }
            }
            
            // 강제로 스타일 재계산
            mainBottomText.offsetHeight;
        }

        function goToSlide(index) {
            slidesContainer.style.transform = `translateX(-${index * 100}vw)`;
            currentIndex = index;
            updateProjectName(index - 1);
        }

        function showNextSlide() {
            if (isTransitioning) return;
            isTransitioning = true;
            goToSlide(currentIndex + 1);

            setTimeout(() => {
                if (currentIndex === totalSlides + 1) {
                    // 마지막 클론 → 진짜 첫 슬라이드로 순간 이동
                    slidesContainer.style.transition = 'none';
                    goToSlide(1);
                    setTimeout(() => {
                        slidesContainer.style.transition = 'transform 0.5s ease';
                        isTransitioning = false;
                    }, 20);
                } else {
                    isTransitioning = false;
                }
            }, 500);
        }

        setInterval(showNextSlide, 3000);
    }
    document.addEventListener('DOMContentLoaded', function() {
        console.log('홈페이지 로드 시작');
        
        // 현재 페이지 메뉴 활성화
        const currentPage = 'index.html';
        const menuLinks = document.querySelectorAll('.menu-link');
        menuLinks.forEach(link => {
            if (link.getAttribute('href') === currentPage) {
                link.classList.add('active');
            }
        });
        
        // Firebase에서 프로젝트 로드
        if (window.loadMainSlides) {
            console.log('loadMainSlides 함수 호출');
            window.loadMainSlides();
        } else if (window.initMainSlider) {
            window.initMainSlider();
        }
    });
    </script>

    <div class="menu-overlay-ex" onclick="closeMenuByBg(event)">
        <div class="menu-list" id="menuList">
            <img src="./image/logo/Logo.png" alt="메뉴 닫기 로고" class="menu-active-logo-icon" id="menuLogoIcon" style="display:none;cursor:pointer;">
            <div class="menu-link-wrap">
                <a href="./about.html" class="menu-link" data-menu="ABOUT">ABOUT</a>
                <span class="menu-underline"></span>
            </div>
            <div class="menu-link-wrap">
                <a href="./projects.html" class="menu-link" data-menu="PROJECTS">PROJECTS</a>
                <span class="menu-underline"></span>
            </div>
            <div class="menu-link-wrap">
                <a href="./contact.html" class="menu-link" data-menu="CONTACT">CONTACT</a>
                <span class="menu-underline"></span>
            </div>
            <div class="menu-social-wrap">
                <a href="https://www.instagram.com/the_hoon_studio/" target="_blank" class="menu-social-link">INSTAGRAM</a>
                <span class="menu-social-divider">|</span>
                <a href="https://www.linkedin.com/in/chang-hoon-jeong-219159304" target="_blank" class="menu-social-link">LINKEDIN</a>
            </div>
        </div>
    </div>

    </script>

    <script>
    function toggleMenu() {
        document.body.classList.toggle('menu-active');
        document.querySelector('.menu-overlay-ex').classList.toggle('active');
        const burger = document.querySelector('.burger-icon-container');
        const logoIcon = document.getElementById('menuLogoIcon');
        if(document.body.classList.contains('menu-active')) {
            burger.classList.add('hidden');
            logoIcon.style.display = 'block';
            logoIcon.src = './image/logo/Logo2.png'; // 흰색 로고로 지정
            logoIcon.style.filter = '';
            logoIcon.style.background = '#ccc'; // 회색 원형 배경
            logoIcon.style.borderRadius = '50%';
            logoIcon.style.position = 'fixed';
            logoIcon.style.top = '106px';
            logoIcon.style.right = '38px';
            logoIcon.style.width = '35.2px';
            logoIcon.style.height = '35.2px';
            logoIcon.style.padding = '0';
            logoIcon.style.objectFit = 'contain';
            logoIcon.style.zIndex = '2000';
            logoIcon.onclick = function(e) {
                e.stopPropagation();
                toggleMenu();
            };
        } else {
            burger.classList.remove('hidden');
            logoIcon.style.display = 'none';
                            logoIcon.src = './image/logo/Logo.png';
            logoIcon.style.filter = '';
            logoIcon.onclick = null;
        }
    }

    function closeMenuByBg(e) {
        if (e.target.classList.contains('menu-overlay-ex')) {
            toggleMenu();
        }
    }
    </script>

<div id="cookieBanner" class="cookie-banner" style="display:none;">
  <div class="cookie-row">
    <img src="./image/logo/Logo.png" alt="cookie" class="cookie-icon">
    <p class="cookie-text">Diese Website verwendet Cookies, um sicherzustellen, dass Sie die beste Erfahrung auf unserer Website erhalten.</p>
  </div>
  <div class="cookie-actions">
    <button id="cookieAccept" class="cookie-btn accept">Akzeptieren</button>
    <button id="cookieDecline" class="cookie-btn decline">Ablehnen</button>
  </div>
</div>

<script>
(function(){
  const KEY = 'ths_cookie_consent_v2';
  const banner = document.getElementById('cookieBanner');
  const accept = document.getElementById('cookieAccept');
  const decline = document.getElementById('cookieDecline');
  try {
    const saved = localStorage.getItem(KEY);
    if (!saved) {
      banner.style.display = 'block';
    }
    accept && accept.addEventListener('click', function(){
      localStorage.setItem(KEY, 'accepted');
      banner.style.display = 'none';
    });
    decline && decline.addEventListener('click', function(){
      localStorage.setItem(KEY, 'declined');
      banner.style.display = 'none';
    });
  } catch(e) {
    // localStorage 불가 시 배너만 닫기 동작
    banner.style.display = 'block';
    accept && accept.addEventListener('click', function(){ banner.style.display = 'none'; });
    decline && decline.addEventListener('click', function(){ banner.style.display = 'none'; });
  }
})();
</script>
</body>
</html>
